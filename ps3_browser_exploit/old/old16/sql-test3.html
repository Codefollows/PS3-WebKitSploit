<!DOCTYPE html>
<html>
<!--  @author Ben Poole, http://benpoole.com  Example HTML5 code for playing with the local WebKit (Opera too?) SQL database.  @see http://benpoole.com/weblog/201106222227 -->
<head>
	<meta charset="UTF-8">
	<style type="text/css">
	 body {font-family: Helvetica, sans-serif; font-size: 100%; line-height: 1.4em}  input, button {width: 25em; font-size: 100%; padding: .25em} 
	</style>
	<script src="include/jquery.js" type="text/javascript">
	</script>
	<script type="text/javascript">
	 // Generic error callback for db transactions  
	 var errCallback = function(){   alert("Oh no! There has been a database error!");  }   
	 // Open / initialise the db - this will fail in browsers like Firefox & IE  
	 var db = openDatabase("expl0itdb", "4.20", "Expl0it_DB_Test", 32678);    
	 // Create expl0itdb table if required  
	 db.transaction(function(transaction){   transaction.executeSql("CREATE TABLE IF NOT EXISTS expl0itdb (" +    "id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT," +    "findname TEXT NOT NULL, location TEXT NOT NULL);");  });   
	 // This is the SAVE function  
	 var saveWinkle = function(findname, location, successCallback){   db.transaction(function(transaction){    transaction.executeSql(("INSERT INTO expl0itdb (findname, location) VALUES (?, ?);"),     [findname, location], function(transaction, results){successCallback(results);}, errCallback);   });  };    
	 // This is a LOAD function, which pulls all expl0itdb for a given location  
	 var loadValues = function(location, successCallback){   db.transaction(function(transaction){    transaction.executeSql(("SELECT * FROM expl0itdb WHERE location=?"), [location],     function(transaction, results){successCallback(results);}, errCallback);    });  };   
	 // Document ready event. Time for some subversive injection, hurr hurr  
	 $(function(){   var form = $("form");     
	 // Callback when loading data (@see showWinkles())   
	 var updatePage = function(results){    var list = $("#findname-list");    list.empty();    console.dir(results);    if (results.rows.length==0){     alert("Alas, there be no expl0itdb here.");    } else {     $.each(results.rows, function(rowIndex){      var row = results.rows.item(rowIndex);      list.append( "<li>" + row.findname + ", " + row.location + "<\/li>");     });    }   };      
	 // Override the default form submit in favour of our code   
	 form.submit(function(event){    event.preventDefault();    saveWinkle($('#findname').val(), $('#location').val(), function(){     alert($('#findname').val() + "'s data has been saved!");    })   });
	 // Bind findname listing to a button in the page   
	 $('#show-me').click(function(){loadValues($('#where').val(), updatePage);});  });
	</script>
</head>
<body>
	<form>
		<h2>Value name &amp; location:</h2>
		<p><input class="name" id="findname" name="findname" placeholder="Value name here" type="text"></p>
		<p><input class="location" id="location" name="location" placeholder="Value location here" type="text"></p>
		<p><input type="submit" value="Save this value"></p>
	</form>
	<p>Type in a location below &amp; then click the button to see what we&#8217;ve got:</p>
	<p><input id="where" name="where" placeholder="Location to check for values"></p>
	<p><input id="show-me" type="button" value="Show me the values!"></p>&nbsp;
	<h2>findname list</h2>
	<ul id="findname-list">
		<!-- set by updatePage() -->
	</ul>
</body>
</html>