<html>
<body>
<div id=testDiv contenteditable>[<b></b><i style="display:none">invisible</i>]</div>
<div id=log></div>

<script>
    if (window.layoutTestController)
        layoutTestController.dumpAsText();

    function log(message) {
        var newChild = document.createElement("div");
        newChild.appendChild(document.createTextNode(message));
        document.getElementById("log").appendChild(newChild);
    }

    function shouldBe(expr, expected) {
        actual = eval(expr);
        if (expected !== actual)
            log('FAIL: Expected "' + expected + '" was: "' + actual + '"');
        else
            log('PASS: ' + expr);
    }

    var testDiv = document.getElementById("testDiv");
    var b = document.getElementsByTagName('b')[0];
    var i = document.getElementsByTagName('i')[0];
    var selection = window.getSelection();
    
    if (!b.firstChild)
        b.appendChild(document.createTextNode(''));

    log("Setting selection to (b, 0) - (b, 0)");
    var range = document.createRange();
    range.setStart(b, 0);
    range.setEnd(b, 0);
    selection.addRange(range);
    shouldBe('selection.anchorNode', b);
    shouldBe('selection.anchorOffset', 0);
    selection.removeAllRanges();

    log("Setting selection to (testDiv, 0) - (testDiv, 0)");
    range = document.createRange();
    range.setStart(testDiv, 0);
    range.setEnd(testDiv, 0);
    selection.addRange(range);
    shouldBe('selection.anchorNode', testDiv);
    shouldBe('selection.anchorOffset', 0);
    selection.removeAllRanges();

    log("Setting selection to (i, 0) - (i, 1)");
    range = document.createRange();
    range.setStart(i, 0);
    range.setEnd(i, 1);
    selection.addRange(range);
    shouldBe('selection.anchorNode', i);
    shouldBe('selection.anchorOffset', 0);
    shouldBe('selection.focusNode', i);
    shouldBe('selection.focusOffset', 1);
    selection.removeAllRanges();

    log("Setting selection to (i.firstChild, 1) - (i.firstChild, 2)");
    range = document.createRange();
    range.setStart(i.firstChild, 1);
    range.setEnd(i.firstChild, 2);
    selection.addRange(range);
    shouldBe('selection.anchorNode', i.firstChild);
    shouldBe('selection.anchorOffset', 1);
    shouldBe('selection.focusNode', i.firstChild);
    shouldBe('selection.focusOffset', 2);
    selection.removeAllRanges();
</script>

</body>
</html>
